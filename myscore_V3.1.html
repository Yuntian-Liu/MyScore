<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyScore V3.1 - æˆ‘çš„æˆç»©å•</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-main: #faf8f5;
            --bg-card: #ffffff;
            --primary: #10b981;
            --primary-dark: #059669;
            --text-main: #1f2937;
            --text-secondary: #6b7280;
            --listening: #3b82f6;
            --reading: #10b981;
            --writing: #f59e0b;
            --speaking: #8b5cf6;
            --translation: #ef4444;
        }
        body { background: linear-gradient(135deg, #faf8f5 0%, #f3f0eb 100%); min-height: 100vh; }
        .card-bright { background: var(--bg-card); border-radius: 1rem; box-shadow: 0 4px 20px rgba(16, 185, 129, 0.08); transition: all 0.3s ease; border: 1px solid rgba(16, 185, 129, 0.1); }
        .card-bright:hover { transform: translateY(-4px); box-shadow: 0 12px 40px rgba(16, 185, 129, 0.15); border-color: rgba(16, 185, 129, 0.3); }
        .gradient-text-bright { background: linear-gradient(135deg, #10b981, #059669); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .subject-card-listening { background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); border: 2px solid #3b82f6; box-shadow: 0 4px 20px rgba(59, 130, 246, 0.15); }
        .subject-card-reading { background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%); border: 2px solid #10b981; box-shadow: 0 4px 20px rgba(16, 185, 129, 0.15); }
        .subject-card-writing { background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%); border: 2px solid #f59e0b; box-shadow: 0 4px 20px rgba(245, 158, 11, 0.15); }
        .subject-card-speaking { background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%); border: 2px solid #8b5cf6; box-shadow: 0 4px 20px rgba(139, 92, 246, 0.15); }
        .subject-card-translation { background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%); border: 2px solid #ef4444; box-shadow: 0 4px 20px rgba(239, 68, 68, 0.15); }
        .subject-card { transition: all 0.3s ease; border-radius: 1rem; }
        .subject-card:hover { transform: translateY(-2px); box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12); }
        .input-bright { background: #ffffff; border: 2px solid #e5e7eb; transition: all 0.3s ease; }
        .input-bright:focus { outline: none; border-color: #10b981; box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1); }
        .input-bright.input-error { border-color: #ef4444; box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1); }
        .input-warning { font-size: 0.75rem; color: #ef4444; margin-top: 0.25rem; }
        .btn-primary { background: linear-gradient(135deg, #10b981, #059669); transition: all 0.3s ease; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3); }
        .btn-primary:active { transform: translateY(0); }
        .accordion-item { transition: all 0.3s ease; border-radius: 1rem; margin-bottom: 1rem; }
        .accordion-item:last-child { margin-bottom: 0; }
        .accordion-header { cursor: pointer; display: flex; justify-content: space-between; align-items: center; padding: 1rem; transition: all 0.3s ease; }
        .accordion-header:hover { opacity: 0.9; }
        .accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease; }
        .accordion-content.expanded { max-height: 800px; }
        .accordion-arrow { transition: transform 0.3s ease; }
        .accordion-arrow.expanded { transform: rotate(180deg); }
        .dashboard-tab { transition: all 0.3s ease; border-bottom: 2px solid transparent; }
        .dashboard-tab.active { border-bottom-color: #10b981; color: #10b981; }
        .dashboard-tab:not(.active):hover { color: #10b981; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .stat-card { background: linear-gradient(135deg, #ffffff 0%, #f9fafb 100%); border: 2px solid #e5e7eb; border-radius: 1rem; transition: all 0.3s ease; }
        .stat-card:hover { border-color: #10b981; box-shadow: 0 8px 25px rgba(16, 185, 129, 0.15); }
        .exam-type-btn { transition: all 0.3s ease; border: 2px solid transparent; }
        .exam-type-btn.active { background: linear-gradient(135deg, #10b981, #059669); color: white; border-color: #059669; box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3); }
        .exam-type-btn:not(.active):hover { border-color: #10b981; background-color: rgba(16, 185, 129, 0.1); }
        .data-management-section { background: linear-gradient(135deg, #f0fdf4 0%, #ecfeff 50%, #f0f9ff 100%); border-radius: 1.5rem; border: 2px solid #a7f3d0; padding: 2rem; margin-top: 2rem; margin-bottom: 2rem; box-shadow: 0 10px 40px rgba(16, 185, 129, 0.1); }
        .data-management-title { display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid #e5e7eb; }
        .data-management-title svg { width: 28px; height: 28px; color: #10b981; }
        .data-management-title h2 { font-size: 1.5rem; font-weight: 700; color: #1f2937; }
        .data-card { background: #ffffff; border-radius: 1rem; padding: 1.5rem; transition: all 0.3s ease; height: 100%; display: flex; flex-direction: column; }
        .data-card:hover { transform: translateY(-4px); box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1); }
        .data-card-export { border: 2px solid #93c5fd; }
        .data-card-export:hover { border-color: #3b82f6; box-shadow: 0 20px 40px rgba(59, 130, 246, 0.15); }
        .data-card-import { border: 2px solid #a7f3d0; }
        .data-card-import:hover { border-color: #10b981; box-shadow: 0 20px 40px rgba(16, 185, 129, 0.15); }
        .data-card-icon { width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-bottom: 1rem; }
        .data-card-export .data-card-icon { background: linear-gradient(135deg, #dbeafe, #bfdbfe); }
        .data-card-import .data-card-icon { background: linear-gradient(135deg, #d1fae5, #a7f3d0); }
        .data-card-icon svg { width: 24px; height: 24px; }
        .data-card-export .data-card-icon svg { color: #3b82f6; }
        .data-card-import .data-card-icon svg { color: #10b981; }
        .data-card-title { font-size: 1.125rem; font-weight: 700; margin-bottom: 0.5rem; }
        .data-card-export .data-card-title { color: #1e40af; }
        .data-card-import .data-card-title { color: #065f46; }
        .data-card-description { color: #6b7280; font-size: 0.875rem; line-height: 1.6; margin-bottom: 1.5rem; flex-grow: 1; }
        .data-card-btn { width: 100%; padding: 0.875rem 1.5rem; border-radius: 0.75rem; font-weight: 600; font-size: 0.9375rem; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 0.5rem; }
        .data-card-btn svg { width: 20px; height: 20px; }
        .btn-export { background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; border: none; }
        .btn-export:hover { background: linear-gradient(135deg, #2563eb, #1d4ed8); transform: translateY(-2px); box-shadow: 0 10px 20px rgba(37, 99, 235, 0.3); }
        .file-upload-area { position: relative; margin-top: auto; }
        .file-upload-btn { width: 100%; padding: 0.875rem 1.5rem; background: linear-gradient(135deg, #10b981, #059669); color: white; border: none; border-radius: 0.75rem; font-weight: 600; font-size: 0.9375rem; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 0.5rem; }
        .file-upload-btn:hover { background: linear-gradient(135deg, #059669, #047857); transform: translateY(-2px); box-shadow: 0 10px 20px rgba(5, 150, 105, 0.3); }
        .file-upload-btn svg { width: 20px; height: 20px; }
        .file-upload-input { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; }
        .file-status { margin-top: 0.75rem; padding: 0.5rem 0.75rem; background: #f3f4f6; border-radius: 0.5rem; font-size: 0.8125rem; color: #6b7280; text-align: center; }
        .file-status.success { background: #d1fae5; color: #065f46; }
        .data-stats { display: flex; gap: 1rem; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #e5e7eb; }
        .data-stat-item { display: flex; align-items: center; gap: 0.5rem; font-size: 0.8125rem; color: #6b7280; }
        .data-stat-item svg { width: 16px; height: 16px; color: #9ca3af; }
        .data-stat-value { font-weight: 600; color: #374151; }
        .chart-container { background: #ffffff; border-radius: 1rem; padding: 1.5rem; margin-top: 1.5rem; border: 2px solid #e5e7eb; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05); }
        .chart-title { font-size: 1rem; font-weight: 600; color: #374151; margin-bottom: 1rem; padding-bottom: 0.75rem; border-bottom: 1px solid #e5e7eb; }
        .chart-wrapper { position: relative; height: 300px; }
        .no-data-message { text-align: center; padding: 2rem; color: #9ca3af; }
        .no-data-message svg { width: 48px; height: 48px; margin-bottom: 1rem; opacity: 0.5; }
    </style>
</head>
<body class="text-gray-900">
    <div id="app" class="container mx-auto px-4 py-8 max-w-5xl">
        <header class="mb-8">
            <div class="card-bright p-6 flex flex-col sm:flex-row justify-between items-center gap-4">
                <div>
                    <h1 class="text-4xl font-bold gradient-text-bright">MyScore</h1>
                    <p class="text-gray-500 text-sm mt-1">æˆ‘çš„æˆç»©å• (V3.1 - æ•°æ®å¯è§†åŒ–å‡çº§)</p>
                </div>
                <nav class="flex gap-3">
                    <button onclick="showPage('dashboard')" id="nav-dashboard" class="px-5 py-2.5 rounded-lg bg-emerald-500 hover:bg-emerald-600 text-white transition-all font-medium shadow-md">ä»ªè¡¨ç›˜</button>
                    <button onclick="showPage('entry')" id="nav-entry" class="px-5 py-2.5 rounded-lg bg-gray-200 hover:bg-gray-300 text-gray-700 transition-all font-medium">å½•å…¥æˆç»©</button>
                </nav>
            </div>
        </header>
        <div id="page-dashboard" class="page">
            <div class="card-bright p-4 mb-6">
                <div class="flex gap-6 border-b border-gray-200">
                    <button onclick="switchDashboardTab('overview')" id="tab-overview" class="dashboard-tab active px-4 py-2 text-gray-600 font-medium">æ¦‚è§ˆ</button>
                    <button onclick="switchDashboardTab('ielts')" id="tab-ielts" class="dashboard-tab px-4 py-2 text-gray-600 font-medium">é›…æ€ç»Ÿè®¡</button>
                    <button onclick="switchDashboardTab('cet')" id="tab-cet" class="dashboard-tab px-4 py-2 text-gray-600 font-medium">å››å…­çº§ç»Ÿè®¡</button>
                </div>
            </div>
            <div id="tab-content-overview" class="tab-content active">
                <div id="recent-score-card" class="card-bright p-8 mb-6">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-6">æœ€è¿‘æˆç»©</h2>
                    <div id="recent-score-content"></div>
                </div>
                <div class="card-bright p-6 mb-6">
                    <div class="text-gray-500 text-sm mb-2 font-medium">æ€»è€ƒè¯•æ¬¡æ•°</div>
                    <div id="total-count" class="text-4xl font-bold text-emerald-600">0</div>
                </div>
            </div>
            <div id="tab-content-ielts" class="tab-content">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div class="stat-card p-6">
                        <div class="text-gray-500 text-sm mb-2 font-medium">é›…æ€æœ€ä½³Overall</div>
                        <div id="ielts-best" class="text-4xl font-bold text-blue-600">-</div>
                    </div>
                    <div class="stat-card p-6">
                        <div class="text-gray-500 text-sm mb-2 font-medium">é›…æ€å¹³å‡Overall</div>
                        <div id="ielts-avg" class="text-4xl font-bold text-purple-600">-</div>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div class="stat-card p-6">
                        <div class="text-gray-500 text-sm mb-2 font-medium">é›…æ€è€ƒè¯•æ¬¡æ•°</div>
                        <div id="ielts-count" class="text-4xl font-bold text-emerald-600">-</div>
                    </div>
                    <div class="stat-card p-6">
                        <div class="text-gray-500 text-sm mb-2 font-medium">æœ€è¿‘ä¸€æ¬¡é›…æ€</div>
                        <div id="ielts-latest" class="text-4xl font-bold text-gray-600">-</div>
                    </div>
                </div>
                <div class="chart-container">
                    <h3 class="chart-title">ğŸ“ˆ é›…æ€åˆ†æ•°è¶‹åŠ¿</h3>
                    <div class="chart-wrapper">
                        <canvas id="ielts-chart"></canvas>
                    </div>
                    <div id="ielts-no-data" class="no-data-message" style="display: none;">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>
                        <p>æš‚æ— é›…æ€æ•°æ®ï¼Œè¯·å…ˆå½•å…¥æˆç»©</p>
                    </div>
                </div>
            </div>
            <div id="tab-content-cet" class="tab-content">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div class="stat-card p-6"><div class="text-gray-500 text-sm mb-2 font-medium">å››çº§æœ€ä½³</div><div id="cet4-best" class="text-4xl font-bold text-blue-600">-</div></div>
                    <div class="stat-card p-6"><div class="text-gray-500 text-sm mb-2 font-medium">å››çº§å¹³å‡</div><div id="cet4-avg" class="text-4xl font-bold text-purple-600">-</div></div>
                    <div class="stat-card p-6"><div class="text-gray-500 text-sm mb-2 font-medium">å…­çº§æœ€ä½³</div><div id="cet6-best" class="text-4xl font-bold text-blue-600">-</div></div>
                    <div class="stat-card p-6"><div class="text-gray-500 text-sm mb-2 font-medium">å…­çº§å¹³å‡</div><div id="cet6-avg" class="text-4xl font-bold text-purple-600">-</div></div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div class="stat-card p-6"><div class="text-gray-500 text-sm mb-2 font-medium">å››çº§è€ƒè¯•æ¬¡æ•°</div><div id="cet4-count" class="text-4xl font-bold text-emerald-600">-</div></div>
                    <div class="stat-card p-6"><div class="text-gray-500 text-sm mb-2 font-medium">å…­çº§è€ƒè¯•æ¬¡æ•°</div><div id="cet6-count" class="text-4xl font-bold text-emerald-600">-</div></div>
                </div>
                <div class="chart-container">
                    <h3 class="chart-title">ğŸ“ˆ CET-4 åˆ†æ•°è¶‹åŠ¿</h3>
                    <div class="chart-wrapper"><canvas id="cet4-chart"></canvas></div>
                    <div id="cet4-no-data" class="no-data-message" style="display: none;"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg><p>æš‚æ— å››çº§æ•°æ®ï¼Œè¯·å…ˆå½•å…¥æˆç»©</p></div>
                </div>
                <div class="chart-container">
                    <h3 class="chart-title">ğŸ“ˆ CET-6 åˆ†æ•°è¶‹åŠ¿</h3>
                    <div class="chart-wrapper"><canvas id="cet6-chart"></canvas></div>
                    <div id="cet6-no-data" class="no-data-message" style="display: none;"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg><p>æš‚æ— å…­çº§æ•°æ®ï¼Œè¯·å…ˆå½•å…¥æˆç»©</p></div>
                </div>
            </div>
            <div class="data-management-section">
                <div class="data-management-title">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path></svg>
                    <h2>æ•°æ®ç®¡ç†</h2>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="data-card data-card-export">
                        <div class="data-card-icon"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg></div>
                        <h3 class="data-card-title">å¯¼å‡ºå¤‡ä»½</h3>
                        <p class="data-card-description">å°†æ‰€æœ‰æˆç»©è®°å½•å¯¼å‡ºä¸ºJSONæ–‡ä»¶ï¼Œæ”¯æŒå®Œæ•´å¤‡ä»½å’Œè·¨è®¾å¤‡æ•°æ®è¿ç§»ã€‚</p>
                        <button onclick="exportData()" class="data-card-btn btn-export"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>å¯¼å‡ºæ•°æ®</button>
                        <div class="data-stats" id="export-stats">
                            <div class="data-stat-item"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg><span>è®°å½•æ•°é‡:</span><span class="data-stat-value" id="record-count">0</span></div>
                        </div>
                    </div>
                    <div class="data-card data-card-import">
                        <div class="data-card-icon"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg></div>
                        <h3 class="data-card-title">å¯¼å…¥å¤‡ä»½</h3>
                        <p class="data-card-description">ä»JSONæ–‡ä»¶æ¢å¤æˆç»©è®°å½•ã€‚ç³»ç»Ÿé‡‡ç”¨æ™ºèƒ½å»é‡æœºåˆ¶ï¼Œè‡ªåŠ¨è¿‡æ»¤é‡å¤æ•°æ®ã€‚</p>
                        <div class="file-upload-area">
                            <label class="file-upload-btn"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>é€‰æ‹©JSONæ–‡ä»¶å¯¼å…¥</label>
                            <input type="file" id="import-file-input" accept=".json" class="file-upload-input" onchange="handleFileSelect(event)">
                        </div>
                        <div id="file-status" class="file-status">æš‚æœªé€‰æ‹©æ–‡ä»¶</div>
                    </div>
                </div>
            </div>
            <div class="card-bright p-8 mt-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-gray-800">å†å²è®°å½•</h2>
                    <button onclick="clearAllRecords()" class="text-red-500 hover:text-red-600 text-sm font-semibold transition-colors">æ¸…ç©ºæ‰€æœ‰è®°å½•</button>
                </div>
                <div id="records-list" class="space-y-3"></div>
            </div>
        </div>
        <div id="page-entry" class="page hidden">
            <div class="card-bright p-6 mb-6">
                <h2 class="text-lg font-semibold text-gray-800 mb-4">é€‰æ‹©è€ƒè¯•ç±»å‹</h2>
                <div class="flex gap-3">
                    <button onclick="switchExamType('ielts')" id="btn-ielts" class="exam-type-btn active px-6 py-3 rounded-lg font-semibold">é›…æ€</button>
                    <button onclick="switchExamType('cet4')" id="btn-cet4" class="exam-type-btn px-6 py-3 rounded-lg font-semibold text-gray-700">å››çº§ (CET-4)</button>
                    <button onclick="switchExamType('cet6')" id="btn-cet6" class="exam-type-btn px-6 py-3 rounded-lg font-semibold text-gray-700">å…­çº§ (CET-6)</button>
                </div>
            </div>
            <div id="ielts-form-container">
                <div class="card-bright p-8 mb-6">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-6">å½•å…¥é›…æ€æˆç»©</h2>
                    <form id="ielts-form" class="space-y-6">
                        <div><label class="block text-gray-700 text-sm font-medium mb-2">è€ƒè¯•æ—¥æœŸ</label><input type="date" id="ielts-exam-date" required class="w-full input-bright rounded-lg px-4 py-3 text-gray-900"><div id="ielts-date-warning" class="input-warning"></div></div>
                        <div class="space-y-4">
                            <div class="accordion-item subject-card subject-card-listening" id="ielts-listening-accordion">
                                <div class="accordion-header" onclick="toggleAccordion('ielts-listening')">
                                    <h3 class="text-lg font-bold text-blue-700">Listening</h3>
                                    <div class="flex items-center gap-2"><span class="text-sm text-gray-500" id="ielts-listening-status">æœªå¡«å†™</span><svg class="accordion-arrow w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></div>
                                </div>
                                <div class="accordion-content" id="ielts-listening-content">
                                    <div class="p-6 pt-0 space-y-4">
                                        <div><label class="block text-blue-600 text-sm font-medium mb-2">æ­£ç¡®é¢˜æ•° (0-40)</label><input type="number" id="ielts-listening-raw" min="0" max="40" required placeholder="è¯·è¾“å…¥æ­£ç¡®é¢˜æ•° (0-40)" class="w-full input-bright rounded-lg px-4 py-3 text-gray-900"><div id="ielts-listening-warning" class="input-warning"></div></div>
                                        <div class="bg-white/70 rounded-lg p-4 border-2 border-blue-300"><div class="text-blue-600 text-sm font-medium">æŠ˜ç®—åˆ†</div><div id="ielts-listening-score" class="text-3xl font-bold text-blue-700">0.0</div></div>
                                    </div>
                                </div>
                            </div>
                            <div class="accordion-item subject-card subject-card-reading" id="ielts-reading-accordion">
                                <div class="accordion-header" onclick="toggleAccordion('ielts-reading')">
                                    <h3 class="text-lg font-bold text-emerald-700">Reading (Academic)</h3>
                                    <div class="flex items-center gap-2"><span class="text-sm text-gray-500" id="ielts-reading-status">æœªå¡«å†™</span><svg class="accordion-arrow w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></div>
                                </div>
                                <div class="accordion-content" id="ielts-reading-content">
                                    <div class="p-6 pt-0 space-y-4">
                                        <div><label class="block text-emerald-600 text-sm font-medium mb-2">æ­£ç¡®é¢˜æ•° (0-40)</label><input type="number" id="ielts-reading-raw" min="0" max="40" required placeholder="è¯·è¾“å…¥æ­£ç¡®é¢˜æ•° (0-40)" class="w-full input-bright rounded-lg px-4 py-3 text-gray-900"><div id="ielts-reading-warning" class="input-warning"></div></div>
                                        <div class="bg-white/70 rounded-lg p-4 border-2 border-emerald-300"><div class="text-emerald-600 text-sm font-medium">æŠ˜ç®—åˆ†</div><div id="ielts-reading-score" class="text-3xl font-bold text-emerald-700">0.0</div></div>
                                    </div>
                                </div>
                            </div>
                            <div class="accordion-item subject-card subject-card-writing" id="ielts-writing-accordion">
                                <div class="accordion-header" onclick="toggleAccordion('ielts-writing')">
                                    <h3 class="text-lg font-bold text-amber-700">Writing</h3>
                                    <div class="flex items-center gap-2"><span class="text-sm text-gray-500" id="ielts-writing-status">æœªå¡«å†™</span><svg class="accordion-arrow w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></div>
                                </div>
                                <div class="accordion-content" id="ielts-writing-content">
                                    <div class="p-6 pt-0 space-y-4">
                                        <div><label class="block text-amber-600 text-sm font-medium mb-2">æ€»åˆ† (0-9ï¼Œæ­¥é•¿0.5)</label><input type="number" id="ielts-writing-score" min="0" max="9" step="0.5" required placeholder="è¯·è¾“å…¥æ€»åˆ† (0-9)" class="w-full input-bright rounded-lg px-4 py-3 text-gray-900"><div id="ielts-writing-warning" class="input-warning"></div></div>
                                        <div class="pt-4 space-y-3 border-t-2 border-amber-300 mt-4">
                                            <div><label class="block text-amber-600 text-sm font-medium mb-2">Task 1 (å°ä½œæ–‡)</label><input type="number" id="ielts-writing-task1" min="0" max="9" step="0.5" placeholder="è¯·è¾“å…¥Task1åˆ†æ•°" class="w-full input-bright rounded-lg px-4 py-3 text-gray-900"><div id="ielts-task1-warning" class="input-warning"></div></div>
                                            <div><label class="block text-amber-600 text-sm font-medium mb-2">Task 2 (å¤§ä½œæ–‡)</label><input type="number" id="ielts-writing-task2" min="0" max="9" step="0.5" placeholder="è¯·è¾“å…¥Task2åˆ†æ•°" class="w-full input-bright rounded-lg px-4 py-3 text-gray-900"><div id="ielts-task2-warning" class="input-warning"></div></div>
                                            <div class="bg-white/70 rounded-lg p-3 border-2 border-amber-300"><div class="text-amber-600 text-sm font-medium">è‡ªåŠ¨è®¡ç®—</div><div id="ielts-writing-calculated" class="text-xl font-bold text-amber-700">-</div></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="accordion-item subject-card subject-card-speaking" id="ielts-speaking-accordion">
                                <div class="accordion-header" onclick="toggleAccordion('ielts-speaking')">
                                    <h3 class="text-lg font-bold text-purple-700">Speaking</h3>
                                    <div class="flex items-center gap-2"><span class="text-sm text-gray-500" id="ielts-speaking-status">æœªå¡«å†™</span><svg class="accordion-arrow w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></div>
                                </div>
                                <div class="accordion-content" id="ielts-speaking-content">
                                    <div class="p-6 pt-0 space-y-4">
                                        <div><label class="block text-purple-600 text-sm font-medium mb-2">æ€»åˆ† (0-9ï¼Œæ­¥é•¿0.5)</label><input type="number" id="ielts-speaking-score" min="0" max="9" step="0.5" required placeholder="è¯·è¾“å…¥æ€»åˆ† (0-9)" class="w-full input-bright rounded-lg px-4 py-3 text-gray-900"><div id="ielts-speaking-warning" class="input-warning"></div></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-emerald-50 to-teal-50 rounded-xl p-6 border-2 border-emerald-300">
                            <div class="text-emerald-700 text-sm mb-3 font-semibold">Overall æ€»åˆ†é¢„è§ˆ</div>
                            <div class="flex items-center justify-between flex-wrap gap-4">
                                <div class="text-gray-600 font-medium">L: <span id="ielts-overall-l" class="text-blue-700 font-bold">0.0</span></div>
                                <div class="text-gray-600 font-medium">R: <span id="ielts-overall-r" class="text-emerald-700 font-bold">0.0</span></div>
                                <div class="text-gray-600 font-medium">W: <span id="ielts-overall-w" class="text-amber-700 font-bold">0.0</span></div>
                                <div class="text-gray-600 font-medium">S: <span id="ielts-overall-s" class="text-purple-700 font-bold">0.0</span></div>
                                <div class="text-right"><div class="text-emerald-600 text-sm font-medium">Overall</div><div id="ielts-overall-score" class="text-5xl font-bold gradient-text-bright">0.0</div></div>
                            </div>
                        </div>
                        <button type="submit" class="w-full btn-primary text-white font-bold py-4 px-6 rounded-lg shadow-lg">ä¿å­˜æˆç»©</button>
                    </form>
                </div>
            </div>
            <div id="cet-form-container" class="hidden">
                <div class="card-bright p-8 mb-6">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-6">å½•å…¥<span id="cet-exam-title">å››çº§</span>æˆç»©</h2>
                    <form id="cet-form" class="space-y-6">
                        <div><label class="block text-gray-700 text-sm font-medium mb-2">è€ƒè¯•æ—¥æœŸ</label><input type="date" id="cet-exam-date" required class="w-full input-bright rounded-lg px-4 py-3 text-gray-900"><div id="cet-date-warning" class="input-warning"></div></div>
                        <div class="space-y-4">
                            <div class="accordion-item subject-card subject-card-listening" id="cet-listening-accordion">
                                <div class="accordion-header" onclick="toggleAccordion('cet-listening')">
                                    <h3 class="text-lg font-bold text-blue-700">å¬åŠ› (35%ï¼Œæ»¡åˆ†249åˆ†)</h3>
                                    <div class="flex items-center gap-2"><span class="text-sm text-gray-500" id="cet-listening-status">æœªå¡«å†™</span><svg class="accordion-arrow w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></div>
                                </div>
                                <div class="accordion-content" id="cet-listening-content">
                                    <div class="p-6 pt-0 space-y-4">
                                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                            <div><label class="block text-blue-600 text-sm font-medium mb-2">Section A (7.1åˆ†/é¢˜)</label><input type="number" id="cet-listening-sectiona" min="0" max="8" required placeholder="é¢˜æ•° (0-8)" class="w-full input-bright rounded-lg px-4 py-3 text-gray-900"><div id="cet-sectiona-warning" class="input-warning"></div></div>
                                            <div><label class="block text-blue-600 text-sm font-medium mb-2">Section B (7.1åˆ†/é¢˜)</label><input type="number" id="cet-listening-sectionb" min="0" max="7" required placeholder="é¢˜æ•° (0-7)" class="w-full input-bright rounded-lg px-4 py-3 text-gray-900"><div id="cet-sectionb-warning" class="input-warning"></div></div>
                                            <div><label class="block text-blue-600 text-sm font-medium mb-2">Section C (14.2åˆ†/é¢˜)</label><input type="number" id="cet-listening-sectionc" min="0" max="10" required placeholder="é¢˜æ•° (0-10)" class="w-full input-bright rounded-lg px-4 py-3 text-gray-900"><div id="cet-sectionc-warning" class="input-warning"></div></div>
                                        </div>
                                        <div class="bg-white/70 rounded-lg p-4 border-2 border-blue-300"><div class="flex justify-between items-center"><div class="text-blue-600 text-sm font-medium">å¬åŠ›æ€»åˆ†</div><div id="cet-listening-total" class="text-3xl font-bold text-blue-700">0</div></div></div>
                                    </div>
                                </div>
                            </div>
                            <div class="accordion-item subject-card subject-card-reading" id="cet-reading-accordion">
                                <div class="accordion-header" onclick="toggleAccordion('cet-reading')">
                                    <h3 class="text-lg font-bold text-emerald-700">é˜…è¯» (35%ï¼Œæ»¡åˆ†249åˆ†)</h3>
                                    <div class="flex items-center gap-2"><span class="text-sm text-gray-500" id="cet-reading-status">æœªå¡«å†™</span><svg class="accordion-arrow w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></div>
                                </div>
                                <div class="accordion-content" id="cet-reading-content">
                                    <div class="p-6 pt-0 space-y-4">
                                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                            <div><label class="block text-emerald-600 text-sm font-medium mb-2">é€‰è¯å¡«ç©º (3.55åˆ†/é¢˜)</label><input type="number" id="cet-reading-wordbank" min="0" max="10" required placeholder="é¢˜æ•° (0-10)" class="w-full input-bright rounded-lg px-4 py-3 text-gray-900"><div id="cet-wordbank-warning" class="input-warning"></div></div>
                                            <div><label class="block text-emerald-600 text-sm font-medium mb-2">é•¿ç¯‡é˜…è¯» (7.1åˆ†/é¢˜)</label><input type="number" id="cet-reading-skimming" min="0" max="10" required placeholder="é¢˜æ•° (0-10)" class="w-full input-bright rounded-lg px-4 py-3 text-gray-900"><div id="cet-skimming-warning" class="input-warning"></div></div>
                                            <div><label class="block text-emerald-600 text-sm font-medium mb-2">ä»”ç»†é˜…è¯» (14.2åˆ†/é¢˜)</label><input type="number" id="cet-reading-reading" min="0" max="10" required placeholder="é¢˜æ•° (0-10)" class="w-full input-bright rounded-lg px-4 py-3 text-gray-900"><div id="cet-reading-warning" class="input-warning"></div></div>
                                        </div>
                                        <div class="bg-white/70 rounded-lg p-4 border-2 border-emerald-300"><div class="flex justify-between items-center"><div class="text-emerald-600 text-sm font-medium">é˜…è¯»æ€»åˆ†</div><div id="cet-reading-total" class="text-3xl font-bold text-emerald-700">0</div></div></div>
                                    </div>
                                </div>
                            </div>
                            <div class="accordion-item subject-card subject-card-writing" id="cet-writing-accordion">
                                <div class="accordion-header" onclick="toggleAccordion('cet-writing')">
                                    <h3 class="text-lg font-bold text-amber-700">å†™ä½œ (15%ï¼Œæ»¡åˆ†106.5åˆ†)</h3>
                                    <div class="flex items-center gap-2"><span class="text-sm text-gray-500" id="cet-writing-status">æœªå¡«å†™</span><svg class="accordion-arrow w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></div>
                                </div>
                                <div class="accordion-content" id="cet-writing-content">
                                    <div class="p-6 pt-0 space-y-4">
                                        <div><label class="block text-amber-600 text-sm font-medium mb-2">åŸå§‹åˆ† (0-15åˆ†)</label><input type="number" id="cet-writing-raw" min="0" max="15" step="0.5" required placeholder="è¯·è¾“å…¥åŸå§‹åˆ†" class="w-full input-bright rounded-lg px-4 py-3 text-gray-900"><div id="cet-writing-warning" class="input-warning"></div></div>
                                        <div class="bg-white/70 rounded-lg p-4 border-2 border-amber-300"><div class="flex justify-between items-center"><div class="text-amber-600 text-sm font-medium">æŠ¥é“åˆ†</div><div id="cet-writing-score" class="text-3xl font-bold text-amber-700">0</div></div></div>
                                    </div>
                                </div>
                            </div>
                            <div class="accordion-item subject-card subject-card-translation" id="cet-translation-accordion">
                                <div class="accordion-header" onclick="toggleAccordion('cet-translation')">
                                    <h3 class="text-lg font-bold text-red-700">ç¿»è¯‘ (15%ï¼Œæ»¡åˆ†106.5åˆ†)</h3>
                                    <div class="flex items-center gap-2"><span class="text-sm text-gray-500" id="cet-translation-status">æœªå¡«å†™</span><svg class="accordion-arrow w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></div>
                                </div>
                                <div class="accordion-content" id="cet-translation-content">
                                    <div class="p-6 pt-0 space-y-4">
                                        <div><label class="block text-red-600 text-sm font-medium mb-2">åŸå§‹åˆ† (0-15åˆ†)</label><input type="number" id="cet-translation-raw" min="0" max="15" step="0.5" required placeholder="è¯·è¾“å…¥åŸå§‹åˆ†" class="w-full input-bright rounded-lg px-4 py-3 text-gray-900"><div id="cet-translation-warning" class="input-warning"></div></div>
                                        <div class="bg-white/70 rounded-lg p-4 border-2 border-red-300"><div class="flex justify-between items-center"><div class="text-red-600 text-sm font-medium">æŠ¥é“åˆ†</div><div id="cet-translation-score" class="text-3xl font-bold text-red-700">0</div></div></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-emerald-50 to-teal-50 rounded-xl p-6 border-2 border-emerald-300">
                            <div class="text-emerald-700 text-sm mb-3 font-semibold">æ€»åˆ†é¢„è§ˆ (æ»¡åˆ†710åˆ†)</div>
                            <div class="flex items-center justify-between flex-wrap gap-4">
                                <div class="text-gray-600 font-medium">å¬åŠ›: <span id="cet-total-listening" class="text-blue-700 font-bold">0</span></div>
                                <div class="text-gray-600 font-medium">é˜…è¯»: <span id="cet-total-reading" class="text-emerald-700 font-bold">0</span></div>
                                <div class="text-gray-600 font-medium">å†™ä½œå’Œç¿»è¯‘: <span id="cet-total-wt" class="text-orange-600 font-bold">0</span></div>
                                <div class="text-right"><div class="text-emerald-600 text-sm font-medium">æ€»åˆ†</div><div id="cet-total-score" class="text-5xl font-bold gradient-text-bright">0</div></div>
                            </div>
                        </div>
                        <button type="submit" class="w-full btn-primary text-white font-bold py-4 px-6 rounded-lg shadow-lg">ä¿å­˜æˆç»©</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <script>
        let currentExamType = 'ielts';
        let ieltsChartInstance = null;
        let cet4ChartInstance = null;
        let cet6ChartInstance = null;
        const STORAGE_KEY = 'myscore_v3.1_records';

        function getRecords() { return localStorage.getItem(STORAGE_KEY) ? JSON.parse(localStorage.getItem(STORAGE_KEY)) : []; }
        function saveRecord(record) { const records = getRecords(); records.push(record); localStorage.setItem(STORAGE_KEY, JSON.stringify(records)); }
        function clearAllRecords() { if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æˆç»©è®°å½•å—ï¼Ÿ')) { localStorage.removeItem(STORAGE_KEY); updateUI(); } }
        function deleteRecord(id) { if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ')) { const records = getRecords().filter(r => r.id !== id); localStorage.setItem(STORAGE_KEY, JSON.stringify(records)); updateUI(); } }

        function switchDashboardTab(tabName) {
            document.querySelectorAll('.dashboard-tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(`tab-${tabName}`).classList.add('active');
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(`tab-content-${tabName}`).classList.add('active');
            if (tabName === 'ielts') setTimeout(renderIeltsChart, 100);
            else if (tabName === 'cet') setTimeout(() => { renderCet4Chart(); renderCet6Chart(); }, 100);
        }

        // Chart.js å›¾è¡¨æ¸²æŸ“å‡½æ•°
        function renderIeltsChart() {
            const records = getRecords().filter(r => r.examType === 'ielts');
            const noDataEl = document.getElementById('ielts-no-data');
            const canvas = document.getElementById('ielts-chart');
            if (!canvas) return;
            if (records.length === 0) { noDataEl.style.display = 'block'; if (ieltsChartInstance) { ieltsChartInstance.destroy(); ieltsChartInstance = null; } return; }
            noDataEl.style.display = 'none';
            if (ieltsChartInstance) ieltsChartInstance.destroy();
            const ctx = canvas.getContext('2d');
            ieltsChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: records.map(r => r.date),
                    datasets: [
                        { label: 'Overall', data: records.map(r => r.overall.toFixed(1)), borderColor: '#10b981', backgroundColor: 'rgba(16, 185, 129, 0.1)', tension: 0.4, fill: true },
                        { label: 'Listening', data: records.map(r => r.listening.score.toFixed(1)), borderColor: '#3b82f6', backgroundColor: 'rgba(59, 130, 246, 0.1)', tension: 0.4 },
                        { label: 'Reading', data: records.map(r => r.reading.score.toFixed(1)), borderColor: '#10b981', backgroundColor: 'rgba(16, 185, 129, 0.1)', tension: 0.4 },
                        { label: 'Writing', data: records.map(r => r.writing.score.toFixed(1)), borderColor: '#f59e0b', backgroundColor: 'rgba(245, 158, 11, 0.1)', tension: 0.4 },
                        { label: 'Speaking', data: records.map(r => r.speaking.score.toFixed(1)), borderColor: '#8b5cf6', backgroundColor: 'rgba(139, 92, 246, 0.1)', tension: 0.4 }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } }, scales: { y: { min: 0, max: 9, ticks: { stepSize: 1 } } } }
            });
        }

        function renderCet4Chart() {
            const records = getRecords().filter(r => r.examType === 'cet' && r.examLevel === 'cet4');
            const noDataEl = document.getElementById('cet4-no-data');
            const canvas = document.getElementById('cet4-chart');
            if (!canvas) return;
            if (records.length === 0) { noDataEl.style.display = 'block'; if (cet4ChartInstance) { cet4ChartInstance.destroy(); cet4ChartInstance = null; } return; }
            noDataEl.style.display = 'none';
            if (cet4ChartInstance) cet4ChartInstance.destroy();
            const ctx = canvas.getContext('2d');
            cet4ChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: records.map(r => r.date),
                    datasets: [{ label: 'æ€»åˆ†', data: records.map(r => r.total), borderColor: '#3b82f6', backgroundColor: 'rgba(59, 130, 246, 0.1)', tension: 0.4, fill: true }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } }, scales: { y: { min: 300, max: 600, ticks: { stepSize: 50 } } } }
            });
        }

        function renderCet6Chart() {
            const records = getRecords().filter(r => r.examType === 'cet' && r.examLevel === 'cet6');
            const noDataEl = document.getElementById('cet6-no-data');
            const canvas = document.getElementById('cet6-chart');
            if (!canvas) return;
            if (records.length === 0) { noDataEl.style.display = 'block'; if (cet6ChartInstance) { cet6ChartInstance.destroy(); cet6ChartInstance = null; } return; }
            noDataEl.style.display = 'none';
            if (cet6ChartInstance) cet6ChartInstance.destroy();
            const ctx = canvas.getContext('2d');
            cet6ChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: records.map(r => r.date),
                    datasets: [{ label: 'æ€»åˆ†', data: records.map(r => r.total), borderColor: '#8b5cf6', backgroundColor: 'rgba(139, 92, 246, 0.1)', tension: 0.4, fill: true }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } }, scales: { y: { min: 300, max: 600, ticks: { stepSize: 50 } } } }
            });
        }

        // ==================== åˆ†æ•°è®¡ç®—å‡½æ•° ====================
        function calculateListeningScore(correctCount) {
            const scores = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40];
            return scores[correctCount] || 0;
        }

        function calculateReadingScore(correctCount) {
            const scores = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40];
            return scores[correctCount] || 0;
        }

        function calculateOverall(listening, reading, writing, speaking) {
            const avg = (listening + reading + writing + speaking) / 4;
            return Math.round(avg * 10) / 10;
        }

        function calculateCetListening(sectionA, sectionB, sectionC) {
            return Math.round(sectionA * 7.1 + sectionB * 7.1 + sectionC * 14.2);
        }

        function calculateCetReading(wordBank, skimming, reading) {
            return Math.round(wordBank * 3.55 + skimming * 7.1 + reading * 14.2);
        }

        function convertRawToReportScore(raw) {
            const scores = { 0: 0, 1: 7, 2: 14, 3: 21, 4: 28, 5: 35, 6: 42, 7: 49, 8: 56, 9: 63, 10: 70, 11: 77, 12: 84, 13: 91, 14: 98, 15: 106.5 };
            return scores[raw] || 0;
        }

        // ==================== è¾“å…¥éªŒè¯å‡½æ•° ====================
        function validateNumberInput(input, min, max, warningId) {
            const value = parseFloat(input.value);
            const warningEl = document.getElementById(warningId);
            if (input.value && (isNaN(value) || value < min || value > max)) {
                input.classList.add('input-error');
                warningEl.textContent = `è¯·è¾“å…¥ ${min}-${max} ä¹‹é—´çš„æ•°å€¼`;
                return false;
            } else {
                input.classList.remove('input-error');
                warningEl.textContent = '';
                return true;
            }
        }

        // ==================== æ‰‹é£ç´åŠŸèƒ½ ====================
        function toggleAccordion(itemName) {
            const content = document.getElementById(`${itemName}-content`);
            const arrow = document.querySelector(`#${itemName}-accordion .accordion-arrow`);
            const status = document.getElementById(`${itemName}-status`);
            const isExpanded = content.classList.contains('expanded');

            // å…³é—­æ‰€æœ‰ accordion
            document.querySelectorAll('.accordion-content').forEach(c => c.classList.remove('expanded'));
            document.querySelectorAll('.accordion-arrow').forEach(a => a.classList.remove('expanded'));
            document.querySelectorAll('[id$="-status"]').forEach(s => s.textContent = 'å·²æŠ˜å ');

            // å¦‚æœä¹‹å‰æ˜¯å…³é—­çš„ï¼Œåˆ™å±•å¼€å½“å‰é¡¹
            if (!isExpanded) {
                content.classList.add('expanded');
                if (arrow) arrow.classList.add('expanded');
                if (status) status.textContent = 'å·²å±•å¼€';
            }
        }

        function initAccordions() {
            const firstAccordion = document.querySelector('.accordion-item');
            if (firstAccordion) {
                const itemName = firstAccordion.id.replace('-accordion', '');
                const content = document.getElementById(`${itemName}-content`);
                const arrow = firstAccordion.querySelector('.accordion-arrow');
                const status = document.getElementById(`${itemName}-status`);
                content.classList.add('expanded');
                arrow.classList.add('expanded');
                status.textContent = 'å·²å±•å¼€';
            }
        }

        function updateAccordionStatus(inputId, statusId) {
            const input = document.getElementById(inputId);
            const status = document.getElementById(statusId);
            if (input && input.value && input.value.trim() !== '') {
                status.textContent = 'å·²å¡«å†™';
            } else {
                status.textContent = 'æœªå¡«å†™';
            }
        }

        // ==================== è€ƒè¯•ç±»å‹åˆ‡æ¢ ====================
        function switchExamType(type) {
            currentExamType = type;
            document.querySelectorAll('.exam-type-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`btn-${type}`).classList.add('active');
            if (type === 'ielts') {
                document.getElementById('ielts-form-container').classList.remove('hidden');
                document.getElementById('cet-form-container').classList.add('hidden');
            } else {
                document.getElementById('ielts-form-container').classList.add('hidden');
                document.getElementById('cet-form-container').classList.remove('hidden');
                document.getElementById('cet-exam-title').textContent = type === 'cet4' ? 'å››çº§' : 'å…­çº§';
            }
            resetCurrentForm();
            setTimeout(initAccordions, 100);
        }

        function resetCurrentForm() {
            if (currentExamType === 'ielts') {
                document.getElementById('ielts-form').reset();
                document.getElementById('ielts-listening-score').textContent = '0.0';
                document.getElementById('ielts-reading-score').textContent = '0.0';
                document.getElementById('ielts-writing-calculated').textContent = '-';
                document.querySelectorAll('.input-warning').forEach(w => w.textContent = '');
                document.querySelectorAll('.input-error').forEach(i => i.classList.remove('input-error'));
                updateIeltsOverallPreview();
            } else {
                document.getElementById('cet-form').reset();
                document.querySelectorAll('.input-warning').forEach(w => w.textContent = '');
                document.querySelectorAll('.input-error').forEach(i => i.classList.remove('input-error'));
                updateCetTotalPreview();
            }
        }

        // ==================== å®æ—¶é¢„è§ˆåŠŸèƒ½ ====================
        function updateIeltsOverallPreview() {
            const l = parseFloat(document.getElementById('ielts-listening-score').textContent) || 0;
            const r = parseFloat(document.getElementById('ielts-reading-score').textContent) || 0;
            const w = parseFloat(document.getElementById('ielts-writing-score').value) || 0;
            const s = parseFloat(document.getElementById('ielts-speaking-score').value) || 0;
            document.getElementById('ielts-overall-l').textContent = l.toFixed(1);
            document.getElementById('ielts-overall-r').textContent = r.toFixed(1);
            document.getElementById('ielts-overall-w').textContent = w.toFixed(1);
            document.getElementById('ielts-overall-s').textContent = s.toFixed(1);
            const overall = calculateOverall(l, r, w, s);
            document.getElementById('ielts-overall-score').textContent = overall.toFixed(1);
        }

        function updateCetTotalPreview() {
            const sectionA = parseInt(document.getElementById('cet-listening-sectiona').value) || 0;
            const sectionB = parseInt(document.getElementById('cet-listening-sectionb').value) || 0;
            const sectionC = parseInt(document.getElementById('cet-listening-sectionc').value) || 0;
            const listeningTotal = calculateCetListening(sectionA, sectionB, sectionC);
            document.getElementById('cet-listening-total').textContent = listeningTotal;
            document.getElementById('cet-total-listening').textContent = listeningTotal;

            const wordBank = parseInt(document.getElementById('cet-reading-wordbank').value) || 0;
            const skimming = parseInt(document.getElementById('cet-reading-skimming').value) || 0;
            const reading = parseInt(document.getElementById('cet-reading-reading').value) || 0;
            const readingTotal = calculateCetReading(wordBank, skimming, reading);
            document.getElementById('cet-reading-total').textContent = readingTotal;
            document.getElementById('cet-total-reading').textContent = readingTotal;

            const writingRaw = parseFloat(document.getElementById('cet-writing-raw').value) || 0;
            const writingScore = convertRawToReportScore(writingRaw);
            document.getElementById('cet-writing-score').textContent = writingScore;

            const translationRaw = parseFloat(document.getElementById('cet-translation-raw').value) || 0;
            const translationScore = convertRawToReportScore(translationRaw);
            document.getElementById('cet-translation-score').textContent = translationScore;

            const wtTotal = writingScore + translationScore;
            document.getElementById('cet-total-wt').textContent = wtTotal;

            const total = listeningTotal + readingTotal + wtTotal;
            document.getElementById('cet-total-score').textContent = total;
        }

        // ==================== è¡¨å•äº‹ä»¶ç›‘å¬ ====================
        // é›…æ€è¡¨å•äº‹ä»¶ï¼ˆå·²åœ¨ä¸‹æ–‡å®šä¹‰ï¼‰
        // å››å…­çº§è¡¨å•äº‹ä»¶ï¼ˆå·²åœ¨ä¸‹æ–‡å®šä¹‰ï¼‰
        // ==================== è¡¨å•æäº¤ ====================
        document.getElementById('ielts-form').addEventListener('submit', function(e) {
            e.preventDefault();
            if (!validateNumberInput(document.getElementById('ielts-listening-raw'), 0, 40, 'ielts-listening-warning') ||
                !validateNumberInput(document.getElementById('ielts-reading-raw'), 0, 40, 'ielts-reading-warning') ||
                !validateNumberInput(document.getElementById('ielts-writing-score'), 0, 9, 'ielts-writing-warning') ||
                !validateNumberInput(document.getElementById('ielts-speaking-score'), 0, 9, 'ielts-speaking-warning')) {
                alert('è¯·ä¿®æ­£è¾“å…¥é”™è¯¯');
                return;
            }
            const l = calculateListeningScore(parseInt(document.getElementById('ielts-listening-raw').value));
            const r = calculateReadingScore(parseInt(document.getElementById('ielts-reading-raw').value));
            const w = parseFloat(document.getElementById('ielts-writing-score').value);
            const s = parseFloat(document.getElementById('ielts-speaking-score').value);
            const record = {
                id: Date.now(),
                examType: 'ielts',
                date: document.getElementById('ielts-exam-date').value,
                listening: { raw: parseInt(document.getElementById('ielts-listening-raw').value), score: l },
                reading: { raw: parseInt(document.getElementById('ielts-reading-raw').value), score: r },
                writing: { score: w },
                speaking: { score: s },
                overall: calculateOverall(l, r, w, s)
            };
            saveRecord(record);
            updateUI();
            this.reset();
            document.getElementById('ielts-listening-score').textContent = '0.0';
            document.getElementById('ielts-reading-score').textContent = '0.0';
            updateIeltsOverallPreview();
            initAccordions();
            alert('é›…æ€æˆç»©ä¿å­˜æˆåŠŸï¼');
        });

        document.getElementById('cet-form').addEventListener('submit', function(e) {
            e.preventDefault();
            if (!validateNumberInput(document.getElementById('cet-listening-sectiona'), 0, 8, 'cet-sectiona-warning') ||
                !validateNumberInput(document.getElementById('cet-listening-sectionb'), 0, 7, 'cet-sectionb-warning') ||
                !validateNumberInput(document.getElementById('cet-listening-sectionc'), 0, 10, 'cet-sectionc-warning') ||
                !validateNumberInput(document.getElementById('cet-reading-wordbank'), 0, 10, 'cet-wordbank-warning') ||
                !validateNumberInput(document.getElementById('cet-reading-skimming'), 0, 10, 'cet-skimming-warning') ||
                !validateNumberInput(document.getElementById('cet-reading-reading'), 0, 10, 'cet-reading-warning') ||
                !validateNumberInput(document.getElementById('cet-writing-raw'), 0, 15, 'cet-writing-warning') ||
                !validateNumberInput(document.getElementById('cet-translation-raw'), 0, 15, 'cet-translation-warning')) {
                alert('è¯·ä¿®æ­£è¾“å…¥é”™è¯¯');
                return;
            }
            const sectionA = parseInt(document.getElementById('cet-listening-sectiona').value);
            const sectionB = parseInt(document.getElementById('cet-listening-sectionb').value);
            const sectionC = parseInt(document.getElementById('cet-listening-sectionc').value);
            const wordBank = parseInt(document.getElementById('cet-reading-wordbank').value);
            const skimming = parseInt(document.getElementById('cet-reading-skimming').value);
            const reading = parseInt(document.getElementById('cet-reading-reading').value);
            const writingRaw = parseFloat(document.getElementById('cet-writing-raw').value);
            const translationRaw = parseFloat(document.getElementById('cet-translation-raw').value);
            const listeningTotal = calculateCetListening(sectionA, sectionB, sectionC);
            const readingTotal = calculateCetReading(wordBank, skimming, reading);
            const writingScore = convertRawToReportScore(writingRaw);
            const translationScore = convertRawToReportScore(translationRaw);
            const total = listeningTotal + readingTotal + writingScore + translationScore;
            const record = {
                id: Date.now(),
                examType: 'cet',
                examLevel: currentExamType,
                date: document.getElementById('cet-exam-date').value,
                listening: { sectionA: { count: sectionA }, sectionB: { count: sectionB }, sectionC: { count: sectionC }, total: listeningTotal },
                reading: { wordBank: { count: wordBank }, skimming: { count: skimming }, reading: { count: reading }, total: readingTotal },
                writing: { raw: writingRaw, score: writingScore },
                translation: { raw: translationRaw, score: translationScore },
                total: total
            };
            saveRecord(record);
            updateUI();
            this.reset();
            updateCetTotalPreview();
            initAccordions();
            alert(`${currentExamType === 'cet4' ? 'å››çº§' : 'å…­çº§'}æˆç»©ä¿å­˜æˆåŠŸï¼æ€»åˆ†: ${total}`);
        });

        // ==================== é¡µé¢åˆ‡æ¢ ====================
        function showPage(pageName) {
            document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
            document.getElementById(`page-${pageName}`).classList.remove('hidden');
            document.getElementById('nav-dashboard').className = pageName === 'dashboard' ? 'px-5 py-2.5 rounded-lg bg-emerald-500 text-white shadow-md' : 'px-5 py-2.5 rounded-lg bg-gray-200 text-gray-700';
            document.getElementById('nav-entry').className = pageName === 'entry' ? 'px-5 py-2.5 rounded-lg bg-emerald-500 text-white shadow-md' : 'px-5 py-2.5 rounded-lg bg-gray-200 text-gray-700';
            updateUI();
            if (pageName === 'dashboard') {
                const activeTab = document.querySelector('.dashboard-tab.active').id;
                if (activeTab === 'tab-ielts') setTimeout(renderIeltsChart, 100);
                else if (activeTab === 'tab-cet') setTimeout(() => { renderCet4Chart(); renderCet6Chart(); }, 100);
            } else if (pageName === 'entry') setTimeout(initAccordions, 100);
        }

        // ==================== æ›´æ–°ä»ªè¡¨ç›˜ ====================
        function updateUI() {
            const records = getRecords();
            updateDashboard(records);
            updateRecordsList(records);
            document.getElementById('record-count').textContent = records.length;
        }

        function updateDashboard(records) {
            const recentScoreContent = document.getElementById('recent-score-content');
            const totalCountEl = document.getElementById('total-count');
            if (records.length === 0) {
                recentScoreContent.innerHTML = `<div class="text-center py-12 text-gray-400"><div class="text-6xl mb-4">æš‚æ— æ•°æ®</div><p class="text-xl text-gray-600 font-medium">è¿˜æ²¡æœ‰æˆç»©è®°å½•</p></div>`;
                totalCountEl.textContent = '0';
                resetAllStatCards();
                return;
            }
            const latest = records[records.length - 1];
            if (latest.examType === 'ielts') {
                recentScoreContent.innerHTML = `<div class="mb-6"><div class="text-gray-500 text-sm font-medium">${latest.date} - é›…æ€å­¦æœ¯ç±»</div></div><div class="bg-gradient-to-br from-emerald-50 to-teal-50 rounded-xl p-6 border-2 border-emerald-200"><div class="text-center mb-6"><div class="text-emerald-600 text-sm mb-2 font-semibold">Overall æ€»åˆ†</div><div class="text-6xl font-bold gradient-text-bright">${latest.overall.toFixed(1)}</div></div><div class="grid grid-cols-4 gap-4 text-center"><div class="bg-blue-50 rounded-lg p-3 border-2 border-blue-200"><div class="text-blue-600 text-xs mb-1 font-semibold">Listening</div><div class="text-2xl font-bold text-blue-700">${latest.listening.score.toFixed(1)}</div></div><div class="bg-emerald-50 rounded-lg p-3 border-2 border-emerald-200"><div class="text-emerald-600 text-xs mb-1 font-semibold">Reading</div><div class="text-2xl font-bold text-emerald-700">${latest.reading.score.toFixed(1)}</div></div><div class="bg-amber-50 rounded-lg p-3 border-2 border-amber-200"><div class="text-amber-600 text-xs mb-1 font-semibold">Writing</div><div class="text-2xl font-bold text-amber-700">${latest.writing.score.toFixed(1)}</div></div><div class="bg-purple-50 rounded-lg p-3 border-2 border-purple-200"><div class="text-purple-600 text-xs mb-1 font-semibold">Speaking</div><div class="text-2xl font-bold text-purple-700">${latest.speaking.score.toFixed(1)}</div></div></div></div>`;
            } else {
                const examName = latest.examLevel === 'cet4' ? 'å››çº§' : 'å…­çº§';
                recentScoreContent.innerHTML = `<div class="mb-6"><div class="text-gray-500 text-sm font-medium">${latest.date} - å¤§å­¦${examName}</div></div><div class="bg-gradient-to-br from-emerald-50 to-teal-50 rounded-xl p-6 border-2 border-emerald-200"><div class="text-center mb-6"><div class="text-emerald-600 text-sm mb-2 font-semibold">æ€»åˆ† (æ»¡åˆ†710)</div><div class="text-6xl font-bold gradient-text-bright">${latest.total}</div></div><div class="grid grid-cols-3 gap-4 text-center"><div class="bg-blue-50 rounded-lg p-3 border-2 border-blue-200"><div class="text-blue-600 text-xs mb-1 font-semibold">å¬åŠ›</div><div class="text-2xl font-bold text-blue-700">${latest.listening.total}</div></div><div class="bg-emerald-50 rounded-lg p-3 border-2 border-emerald-200"><div class="text-emerald-600 text-xs mb-1 font-semibold">é˜…è¯»</div><div class="text-2xl font-bold text-emerald-700">${latest.reading.total}</div></div><div class="bg-orange-50 rounded-lg p-3 border-2 border-orange-200"><div class="text-orange-600 text-xs mb-1 font-semibold">å†™ä½œå’Œç¿»è¯‘</div><div class="text-2xl font-bold text-orange-700">${latest.writing.score + latest.translation.score}</div></div></div></div>`;
            }
            totalCountEl.textContent = records.length;
            const ieltsRecords = records.filter(r => r.examType === 'ielts');
            const cet4Records = records.filter(r => r.examType === 'cet' && r.examLevel === 'cet4');
            const cet6Records = records.filter(r => r.examType === 'cet' && r.examLevel === 'cet6');
            if (ieltsRecords.length > 0) {
                const overs = ieltsRecords.map(r => r.overall);
                document.getElementById('ielts-best').textContent = Math.max(...overs).toFixed(1);
                document.getElementById('ielts-avg').textContent = (overs.reduce((a, b) => a + b, 0) / overs.length).toFixed(1);
                document.getElementById('ielts-count').textContent = ieltsRecords.length;
                document.getElementById('ielts-latest').textContent = overs[overs.length - 1].toFixed(1);
            } else {
                ['ielts-best', 'ielts-avg', 'ielts-count', 'ielts-latest'].forEach(id => document.getElementById(id).textContent = id === 'ielts-count' ? '0' : '-');
            }
            if (cet4Records.length > 0) {
                const totals = cet4Records.map(r => r.total);
                document.getElementById('cet4-best').textContent = Math.max(...totals);
                document.getElementById('cet4-avg').textContent = Math.round(totals.reduce((a, b) => a + b, 0) / totals.length);
                document.getElementById('cet4-count').textContent = cet4Records.length;
            } else {
                ['cet4-best', 'cet4-avg', 'cet4-count'].forEach(id => document.getElementById(id).textContent = id === 'cet4-count' ? '0' : '-');
            }
            if (cet6Records.length > 0) {
                const totals = cet6Records.map(r => r.total);
                document.getElementById('cet6-best').textContent = Math.max(...totals);
                document.getElementById('cet6-avg').textContent = Math.round(totals.reduce((a, b) => a + b, 0) / totals.length);
                document.getElementById('cet6-count').textContent = cet6Records.length;
            } else {
                ['cet6-best', 'cet6-avg', 'cet6-count'].forEach(id => document.getElementById(id).textContent = id === 'cet6-count' ? '0' : '-');
            }
        }

        function resetAllStatCards() {
            ['ielts-best', 'ielts-avg', 'ielts-count', 'ielts-latest', 'cet4-best', 'cet4-avg', 'cet4-count', 'cet6-best', 'cet6-avg', 'cet6-count'].forEach(id => {
                document.getElementById(id).textContent = id.includes('count') ? '0' : '-';
            });
        }

        function updateRecordsList(records) {
            const recordsList = document.getElementById('records-list');
            if (records.length === 0) {
                recordsList.innerHTML = `<div class="text-center py-12 text-gray-400"><div class="text-5xl mb-3">æš‚æ— è®°å½•</div><p class="text-lg text-gray-600">è¿˜æ²¡æœ‰å½•å…¥ä»»ä½•æˆç»©</p></div>`;
                return;
            }
            recordsList.innerHTML = [...records].reverse().map(r => r.examType === 'ielts' ?
                `<div class="bg-gradient-to-r from-white to-gray-50 rounded-lg p-5 border-2 border-gray-200 hover:border-emerald-300 transition-all"><div class="flex justify-between items-start"><div class="flex-1"><div class="text-gray-800 font-semibold mb-2">${r.date} - é›…æ€å­¦æœ¯ç±»</div><div class="text-gray-600 text-sm flex gap-3 flex-wrap"><span class="bg-blue-100 text-blue-700 px-2 py-1 rounded">L: ${r.listening.score.toFixed(1)}</span><span class="bg-emerald-100 text-emerald-700 px-2 py-1 rounded">R: ${r.reading.score.toFixed(1)}</span><span class="bg-amber-100 text-amber-700 px-2 py-1 rounded">W: ${r.writing.score.toFixed(1)}</span><span class="bg-purple-100 text-purple-700 px-2 py-1 rounded">S: ${r.speaking.score.toFixed(1)}</span></div><div class="flex items-center gap-2 mt-2"><span class="text-gray-600 text-sm">Overall:</span><span class="text-3xl font-bold gradient-text-bright">${r.overall.toFixed(1)}</span></div></div><button onclick="deleteRecord(${r.id})" class="ml-4 text-gray-400 hover:text-red-500">åˆ é™¤</button></div></div>` :
                `<div class="bg-gradient-to-r from-white to-gray-50 rounded-lg p-5 border-2 border-gray-200 hover:border-emerald-300 transition-all"><div class="flex justify-between items-start"><div class="flex-1"><div class="text-gray-800 font-semibold mb-2">${r.date} - å¤§å­¦${r.examLevel === 'cet4' ? 'å››çº§' : 'å…­çº§'}</div><div class="text-gray-600 text-sm flex gap-3 flex-wrap"><span class="bg-blue-100 text-blue-700 px-2 py-1 rounded">å¬åŠ›: ${r.listening.total}</span><span class="bg-emerald-100 text-emerald-700 px-2 py-1 rounded">é˜…è¯»: ${r.reading.total}</span><span class="bg-orange-100 text-orange-700 px-2 py-1 rounded">å†™ä½œç¿»è¯‘: ${r.writing.score + r.translation.score}</span></div><div class="flex items-center gap-2 mt-2"><span class="text-gray-600 text-sm">æ€»åˆ†:</span><span class="text-3xl font-bold gradient-text-bright">${r.total}</span></div></div><button onclick="deleteRecord(${r.id})" class="ml-4 text-gray-400 hover:text-red-500">åˆ é™¤</button></div></div>`
            ).join('');
        }

        // ==================== æ•°æ®å¯¼å‡ºå¯¼å…¥ ====================
        function exportData() {
            const records = getRecords();
            if (records.length === 0) { alert('æš‚æ— æ•°æ®å¯å¯¼å‡ºï¼'); return; }
            const blob = new Blob([JSON.stringify(records, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `MyScore_Backup_${new Date().toISOString().slice(0, 10).replace(/-/g, '')}.json`;
            a.click();
            URL.revokeObjectURL(url);
            alert(`æ•°æ®å¯¼å‡ºæˆåŠŸï¼å…±å¯¼å‡º ${records.length} æ¡è®°å½•`);
        }

        function handleFileSelect(event) {
            const status = document.getElementById('file-status');
            if (event.target.files.length > 0) {
                status.textContent = `å·²é€‰æ‹©: ${event.target.files[0].name}`;
                status.classList.add('success');
                importData(event);
            } else {
                status.textContent = 'æš‚æœªé€‰æ‹©æ–‡ä»¶';
                status.classList.remove('success');
            }
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file || !file.name.endsWith('.json')) { alert('è¯·é€‰æ‹©JSONæ–‡ä»¶ï¼'); return; }
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    if (!Array.isArray(imported) || imported.length === 0) throw new Error('æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®ï¼');
                    const existing = getRecords();
                    const existingIds = new Set(existing.map(r => r.id));
                    let newCount = 0, dupCount = 0;
                    imported.forEach(r => { if (!existingIds.has(r.id)) { existing.push(r); existingIds.add(r.id); newCount++; } else dupCount++; });
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(existing));
                    updateUI();
                    alert(`æˆåŠŸå¯¼å…¥ ${newCount} æ¡æ–°è®°å½•ï¼Œè¿‡æ»¤äº† ${dupCount} æ¡é‡å¤è®°å½•ã€‚`);
                } catch (err) { alert('å¯¼å…¥å¤±è´¥ï¼š' + err.message); }
            };
            reader.readAsText(file);
        }

        // ==================== åˆå§‹åŒ– ====================
        function init() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('ielts-exam-date').value = today;
            document.getElementById('cet-exam-date').value = today;
            updateUI();
        }
        document.addEventListener('DOMContentLoaded', init);
    </script>

        function toggleAccordion(itemName) {
            const content = document.getElementById(`${itemName}-content`);
            const arrow = document.querySelector(`#${itemName}-accordion .accordion-arrow`);
            const status = document.getElementById(`${itemName}-status`);
            const isExpanded = content.classList.contains('expanded');
            document.querySelectorAll('.accordion-content').forEach(c => c.classList.remove('expanded'));
            document.querySelectorAll('.accordion-arrow').forEach(a => a.classList.remove('expanded'));
            document.querySelectorAll('[id$="-status"]').forEach(s => s.textContent = 'æœªå¡«å†™');
            if (!isExpanded) { content.classList.add('expanded'); arrow.classList.add('expanded'); status.textContent = 'å·²å±•å¼€'; }
        }

        function initAccordions() {
            const firstAccordion = document.querySelector('.accordion-item');
            if (firstAccordion) {
                const itemName = firstAccordion.id.replace('-accordion', '');
                const content = document.getElementById(`${itemName}-content`);
                const arrow = firstAccordion.querySelector('.accordion-arrow');
                const status = document.getElementById(`${itemName}-status`);
                content.classList.add('expanded'); arrow.classList.add('expanded'); status.textContent = 'å·²å±•å¼€';
            }
        }

        function switchExamType(type) {
            currentExamType = type;
            document.querySelectorAll('.exam-type-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`btn-${type}`).classList.add('active');
            if (type === 'ielts') { document.getElementById('ielts-form-container').classList.remove('hidden'); document.getElementById('cet-form-container').classList.add('hidden'); }
            else { document.getElementById('ielts-form-container').classList.add('hidden'); document.getElementById('cet-form-container').classList.remove('hidden'); if (type === 'cet4') { document.getElementById('cet-exam-title').textContent = 'å››çº§'; } else { document.getElementById('cet-exam-title').textContent = 'å…­çº§'; } }
            resetCurrentForm(); setTimeout(initAccordions, 100);
        }

        // æ•°æ®å¤‡ä»½åŠŸèƒ½
        function exportBackup() {
            const records = JSON.parse(localStorage.getItem('myscore_records') || '[]');
            const dataStr = JSON.stringify(records, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            const date = new Date().toISOString().split('T')[0].replace(/-/g, '');
            a.href = url;
            a.download = `MyScore_Backup_${date}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            alert('å¤‡ä»½å¯¼å‡ºæˆåŠŸï¼');
        }

        function importBackup() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importedRecords = JSON.parse(e.target.result);
                        if (!Array.isArray(importedRecords)) { alert('æ–‡ä»¶æ ¼å¼é”™è¯¯'); return; }
                        const existingRecords = JSON.parse(localStorage.getItem('myscore_records') || '[]');
                        const existingIds = new Set(existingRecords.map(r => r.id));
                        let addedCount = 0;
                        let skippedCount = 0;
                        importedRecords.forEach(record => {
                            if (record.id && !existingIds.has(record.id)) { existingRecords.push(record); addedCount++; }
                            else { skippedCount++; }
                        });
                        localStorage.setItem('myscore_records', JSON.stringify(existingRecords));
                        alert(`æˆåŠŸå¯¼å…¥ ${addedCount} æ¡æ–°è®°å½•ï¼Œè¿‡æ»¤äº† ${skippedCount} æ¡é‡å¤è®°å½•ã€‚`);
                        updateUI();
                    } catch (err) { alert('æ–‡ä»¶è§£æå¤±è´¥'); }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        function resetCurrentForm() {
            if (currentExamType === 'ielts') { document.getElementById('ielts-form').reset(); document.getElementById('ielts-listening-score').textContent = '0.0'; document.getElementById('ielts-reading-score').textContent = '0.0'; document.getElementById('ielts-writing-calculated').textContent = '-'; document.querySelectorAll('.input-warning').forEach(w => w.textContent = ''); document.querySelectorAll('.input-error').forEach(i => i.classList.remove('input-error')); updateIeltsOverallPreview(); }
            else { document.getElementById('cet-form').reset(); document.querySelectorAll('.input-warning').forEach(w => w.textContent = ''); document.querySelectorAll('.input-error').forEach(i => i.classList.remove('input-error')); updateCetTotalPreview(); }
        }

        function roundUp(score) { return Math.ceil(score); }

        function calculateListeningScore(correctCount) {
            const table = [[39,40,9.0],[37,38,8.5],[35,36,8.0],[32,34,7.5],[30,31,7.0],[26,29,6.5],[23,25,6.0],[18,22,5.5],[16,17,5.0],[13,15,4.5],[10,12,4.0],[6,9,3.5],[4,5,3.0],[3,3,2.5],[2,2,2.0],[1,1,1.0],[0,0,0.5]];
            for (const [min,max,score] of table) if (correctCount >= min && correctCount <= max) return score; return 0.0;
        }

        function calculateReadingScore(correctCount) {
            const table = [[39,40,9.0],[37,38,8.5],[35,36,8.0],[33,34,7.5],[30,32,7.0],[27,29,6.5],[23,26,6.0],[19,22,5.5],[15,18,5.0],[13,14,4.5],[10,12,4.0],[8,9,3.5],[6,7,3.0],[4,5,2.5],[3,3,2.5],[2,2,2.0],[1,1,1.0],[0,0,0.5]];
            for (const [min,max,score] of table) if (correctCount >= min && correctCount <= max) return score; return 0.0;
        }

        function calculateOverall(l, r, w, s) {
            const avg = (l + r + w + s) / 4;
            const dec = avg - Math.floor(avg);
            if (dec >= 0.25 && dec < 0.5) return Math.floor(avg) + 0.5;
            if (dec >= 0.75) return Math.floor(avg) + 1.0;
            return Math.round(avg * 2) / 2;
        }

        function calculateCetListening(a, b, c) { return roundUp(a * 7.1 + b * 7.1 + c * 14.2); }
        function calculateCetReading(w, s, r) { return roundUp(w * 3.55 + s * 7.1 + r * 14.2); }
        function convertRawToReportScore(raw) { return roundUp(raw * 7.1); }

        function validateNumberInput(input, min, max, warningId) {
            const el = document.getElementById(warningId);
            const val = parseFloat(input.value);
            if (input.value && (isNaN(val) || val < min || val > max)) { el.textContent = `è¯·è¾“å…¥ ${min} åˆ° ${max} ä¹‹é—´çš„æ•°å€¼`; input.classList.add('input-error'); return false; }
            el.textContent = ''; input.classList.remove('input-error'); return true;
        }

        // å›¾è¡¨æ¸²æŸ“å‡½æ•°
        function renderIeltsChart() {
            const records = getRecords().filter(r => r.examType === 'ielts');
            const noDataEl = document.getElementById('ielts-no-data');
            const chartEl = document.getElementById('ielts-chart').parentElement;
            if (ieltsChartInstance) { ieltsChartInstance.destroy(); ieltsChartInstance = null; }
            if (records.length === 0) { noDataEl.style.display = 'block'; chartEl.style.display = 'none'; return; }
            noDataEl.style.display = 'none'; chartEl.style.display = 'block';
            const sorted = [...records].sort((a,b) => new Date(a.date) - new Date(b.date));
            const ctx = document.getElementById('ielts-chart').getContext('2d');
            ieltsChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: sorted.map(r => r.date),
                    datasets: [
                        { label: 'Overall', data: sorted.map(r => r.overall), borderColor: '#10b981', backgroundColor: 'rgba(16,185,129,0.1)', borderWidth: 3, fill: true, tension: 0.3, pointRadius: 5 },
                        { label: 'Listening', data: sorted.map(r => r.listening.score), borderColor: '#3b82f6', borderWidth: 2, tension: 0.3, pointRadius: 4 },
                        { label: 'Reading', data: sorted.map(r => r.reading.score), borderColor: '#10b981', borderWidth: 2, tension: 0.3, pointRadius: 4 },
                        { label: 'Writing', data: sorted.map(r => r.writing.score), borderColor: '#f59e0b', borderWidth: 2, tension: 0.3, pointRadius: 4 },
                        { label: 'Speaking', data: sorted.map(r => r.speaking.score), borderColor: '#8b5cf6', borderWidth: 2, tension: 0.3, pointRadius: 4 }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false, interaction: { mode: 'index', intersect: false }, plugins: { legend: { position: 'top', labels: { usePointStyle: true, padding: 20 } } }, scales: { y: { beginAtZero: true, max: 9, ticks: { stepSize: 1 } }, x: {} } }
            });
        }

        function renderCet4Chart() {
            const records = getRecords().filter(r => r.examType === 'cet' && r.examLevel === 'cet4');
            const noDataEl = document.getElementById('cet4-no-data');
            const chartEl = document.getElementById('cet4-chart').parentElement;
            if (cet4ChartInstance) { cet4ChartInstance.destroy(); cet4ChartInstance = null; }
            if (records.length === 0) { noDataEl.style.display = 'block'; chartEl.style.display = 'none'; return; }
            noDataEl.style.display = 'none'; chartEl.style.display = 'block';
            const sorted = [...records].sort((a,b) => new Date(a.date) - new Date(b.date));
            const ctx = document.getElementById('cet4-chart').getContext('2d');
            cet4ChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: sorted.map(r => r.date),
                    datasets: [
                        { label: 'æ€»åˆ†', data: sorted.map(r => r.total), borderColor: '#10b981', backgroundColor: 'rgba(16,185,129,0.1)', borderWidth: 3, fill: true, tension: 0.3, pointRadius: 5 },
                        { label: 'å¬åŠ›', data: sorted.map(r => r.listening.total), borderColor: '#3b82f6', borderWidth: 2, tension: 0.3, pointRadius: 4 },
                        { label: 'é˜…è¯»', data: sorted.map(r => r.reading.total), borderColor: '#10b981', borderWidth: 2, tension: 0.3, pointRadius: 4 },
                        { label: 'å†™ä½œå’Œç¿»è¯‘', data: sorted.map(r => r.writing.score + r.translation.score), borderColor: '#f59e0b', borderWidth: 2, tension: 0.3, pointRadius: 4 }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false, interaction: { mode: 'index', intersect: false }, plugins: { legend: { position: 'top', labels: { usePointStyle: true, padding: 20 } } }, scales: { y: { beginAtZero: false, min: 300, max: 710, ticks: { stepSize: 50 } }, x: {} } }
            });
        }

        function renderCet6Chart() {
            const records = getRecords().filter(r => r.examType === 'cet' && r.examLevel === 'cet6');
            const noDataEl = document.getElementById('cet6-no-data');
            const chartEl = document.getElementById('cet6-chart').parentElement;
            if (cet6ChartInstance) { cet6ChartInstance.destroy(); cet6ChartInstance = null; }
            if (records.length === 0) { noDataEl.style.display = 'block'; chartEl.style.display = 'none'; return; }
            noDataEl.style.display = 'none'; chartEl.style.display = 'block';
            const sorted = [...records].sort((a,b) => new Date(a.date) - new Date(b.date));
            const ctx = document.getElementById('cet6-chart').getContext('2d');
            cet6ChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: sorted.map(r => r.date),
                    datasets: [
                        { label: 'æ€»åˆ†', data: sorted.map(r => r.total), borderColor: '#8b5cf6', backgroundColor: 'rgba(139,92,246,0.1)', borderWidth: 3, fill: true, tension: 0.3, pointRadius: 5 },
                        { label: 'å¬åŠ›', data: sorted.map(r => r.listening.total), borderColor: '#3b82f6', borderWidth: 2, tension: 0.3, pointRadius: 4 },
                        { label: 'é˜…è¯»', data: sorted.map(r => r.reading.total), borderColor: '#10b981', borderWidth: 2, tension: 0.3, pointRadius: 4 },
                        { label: 'å†™ä½œå’Œç¿»è¯‘', data: sorted.map(r => r.writing.score + r.translation.score), borderColor: '#f59e0b', borderWidth: 2, tension: 0.3, pointRadius: 4 }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false, interaction: { mode: 'index', intersect: false }, plugins: { legend: { position: 'top', labels: { usePointStyle: true, padding: 20 } } }, scales: { y: { beginAtZero: false, min: 300, max: 710, ticks: { stepSize: 50 } }, x: {} } }
            });
        }

        function exportData() {
            const records = getRecords();
            if (records.length === 0) { alert('æš‚æ— æ•°æ®å¯å¯¼å‡ºï¼'); return; }
            const blob = new Blob([JSON.stringify(records, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a'); a.href = url; a.download = `MyScore_Backup_${new Date().toISOString().slice(0,10).replace(/-/g,'')}.json`; a.click(); URL.revokeObjectURL(url);
            alert(`æ•°æ®å¯¼å‡ºæˆåŠŸï¼å…±å¯¼å‡º ${records.length} æ¡è®°å½•`);
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file || !file.name.endsWith('.json')) { alert('è¯·é€‰æ‹©JSONæ–‡ä»¶ï¼'); return; }
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    if (!Array.isArray(imported) || imported.length === 0) throw new Error('æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®ï¼');
                    const existing = getRecords();
                    const existingIds = new Set(existing.map(r => r.id));
                    let newCount = 0, dupCount = 0;
                    imported.forEach(r => { if (!existingIds.has(r.id)) { existing.push(r); existingIds.add(r.id); newCount++; } else dupCount++; });
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(existing));
                    updateUI(); alert(`æˆåŠŸå¯¼å…¥ ${newCount} æ¡æ–°è®°å½•ï¼Œè¿‡æ»¤äº† ${dupCount} æ¡é‡å¤è®°å½•ã€‚`);
                } catch (err) { alert('å¯¼å…¥å¤±è´¥ï¼š' + err.message); }
            };
            reader.readAsText(file);
        }

        function handleFileSelect(event) {
            const status = document.getElementById('file-status');
            if (event.target.files.length > 0) { status.textContent = `å·²é€‰æ‹©: ${event.target.files[0].name}`; status.classList.add('success'); importData(event); }
            else { status.textContent = 'æš‚æœªé€‰æ‹©æ–‡ä»¶'; status.classList.remove('success'); }
        }

        function updateRecordStats() { const el = document.getElementById('record-count'); if (el) el.textContent = getRecords().length; }

        function showPage(pageName) {
            document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
            document.getElementById(`page-${pageName}`).classList.remove('hidden');
            document.getElementById('nav-dashboard').className = pageName === 'dashboard' ? 'px-5 py-2.5 rounded-lg bg-emerald-500 text-white shadow-md' : 'px-5 py-2.5 rounded-lg bg-gray-200 text-gray-700';
            document.getElementById('nav-entry').className = pageName === 'entry' ? 'px-5 py-2.5 rounded-lg bg-emerald-500 text-white shadow-md' : 'px-5 py-2.5 rounded-lg bg-gray-200 text-gray-700';
            updateUI();
            if (pageName === 'dashboard') {
                const activeTab = document.querySelector('.dashboard-tab.active').id;
                if (activeTab === 'tab-ielts') setTimeout(renderIeltsChart, 100);
                else if (activeTab === 'tab-cet') setTimeout(() => { renderCet4Chart(); renderCet6Chart(); }, 100);
            } else if (pageName === 'entry') setTimeout(initAccordions, 100);
        }

        function updateUI() {
            const records = getRecords();
            updateDashboard(records);
            updateRecordsList(records);
            updateRecordStats();
        }

        function updateDashboard(records) {
            const recentContent = document.getElementById('recent-score-content');
            const totalEl = document.getElementById('total-count');
            if (records.length === 0) { recentContent.innerHTML = '<div class="text-center py-12 text-gray-400"><div class="text-6xl mb-4">æš‚æ— æ•°æ®</div><p class="text-xl">è¿˜æ²¡æœ‰æˆç»©è®°å½•</p></div>'; totalEl.textContent = '0'; resetAllStats(); return; }
            const latest = records[records.length - 1];
            if (latest.examType === 'ielts') {
                recentContent.innerHTML = `<div class="mb-6"><div class="text-gray-500 text-sm">${latest.date} - é›…æ€å­¦æœ¯ç±»</div></div><div class="bg-gradient-to-br from-emerald-50 to-teal-50 rounded-xl p-6 border-2 border-emerald-200"><div class="text-center mb-6"><div class="text-emerald-600 text-sm font-semibold">Overall æ€»åˆ†</div><div class="text-6xl font-bold gradient-text-bright">${latest.overall.toFixed(1)}</div></div><div class="grid grid-cols-4 gap-4 text-center"><div class="bg-blue-50 rounded-lg p-3 border-2 border-blue-200"><div class="text-blue-600 text-xs font-semibold">Listening</div><div class="text-2xl font-bold text-blue-700">${latest.listening.score.toFixed(1)}</div></div><div class="bg-emerald-50 rounded-lg p-3 border-2 border-emerald-200"><div class="text-emerald-600 text-xs font-semibold">Reading</div><div class="text-2xl font-bold text-emerald-700">${latest.reading.score.toFixed(1)}</div></div><div class="bg-amber-50 rounded-lg p-3 border-2 border-amber-200"><div class="text-amber-600 text-xs font-semibold">Writing</div><div class="text-2xl font-bold text-amber-700">${latest.writing.score.toFixed(1)}</div></div><div class="bg-purple-50 rounded-lg p-3 border-2 border-purple-200"><div class="text-purple-600 text-xs font-semibold">Speaking</div><div class="text-2xl font-bold text-purple-700">${latest.speaking.score.toFixed(1)}</div></div></div></div>`;
            } else {
                const examName = latest.examLevel === 'cet4' ? 'å››çº§' : 'å…­çº§';
                recentContent.innerHTML = `<div class="mb-6"><div class="text-gray-500 text-sm">${latest.date} - å¤§å­¦${examName}</div></div><div class="bg-gradient-to-br from-emerald-50 to-teal-50 rounded-xl p-6 border-2 border-emerald-200"><div class="text-center mb-6"><div class="text-emerald-600 text-sm font-semibold">æ€»åˆ† (æ»¡åˆ†710)</div><div class="text-6xl font-bold gradient-text-bright">${latest.total}</div></div><div class="grid grid-cols-3 gap-4 text-center"><div class="bg-blue-50 rounded-lg p-3 border-2 border-blue-200"><div class="text-blue-600 text-xs font-semibold">å¬åŠ›</div><div class="text-2xl font-bold text-blue-700">${latest.listening.total}</div></div><div class="bg-emerald-50 rounded-lg p-3 border-2 border-emerald-200"><div class="text-emerald-600 text-xs font-semibold">é˜…è¯»</div><div class="text-2xl font-bold text-emerald-700">${latest.reading.total}</div></div><div class="bg-orange-50 rounded-lg p-3 border-2 border-orange-200"><div class="text-orange-600 text-xs font-semibold">å†™ä½œå’Œç¿»è¯‘</div><div class="text-2xl font-bold text-orange-700">${latest.writing.score + latest.translation.score}</div></div></div></div>`;
            }
            totalEl.textContent = records.length;
            const ieltsRecs = records.filter(r => r.examType === 'ielts');
            const cet4Recs = records.filter(r => r.examType === 'cet' && r.examLevel === 'cet4');
            const cet6Recs = records.filter(r => r.examType === 'cet' && r.examLevel === 'cet6');
            if (ieltsRecs.length > 0) { const overs = ieltsRecs.map(r => r.overall); document.getElementById('ielts-best').textContent = Math.max(...overs).toFixed(1); document.getElementById('ielts-avg').textContent = (overs.reduce((a,b) => a+b,0) / overs.length).toFixed(1); document.getElementById('ielts-count').textContent = ieltsRecs.length; document.getElementById('ielts-latest').textContent = overs[overs.length-1].toFixed(1); }
            else { ['ielts-best','ielts-avg','ielts-count','ielts-latest'].forEach(id => document.getElementById(id).textContent = id === 'ielts-count' ? '0' : '-'); }
            if (cet4Recs.length > 0) { const totals = cet4Recs.map(r => r.total); document.getElementById('cet4-best').textContent = Math.max(...totals); document.getElementById('cet4-avg').textContent = (totals.reduce((a,b) => a+b,0) / totals.length).toFixed(0); document.getElementById('cet4-count').textContent = cet4Recs.length; }
            else { ['cet4-best','cet4-avg','cet4-count'].forEach(id => document.getElementById(id).textContent = id === 'cet4-count' ? '0' : '-'); }
            if (cet6Recs.length > 0) { const totals = cet6Recs.map(r => r.total); document.getElementById('cet6-best').textContent = Math.max(...totals); document.getElementById('cet6-avg').textContent = (totals.reduce((a,b) => a+b,0) / totals.length).toFixed(0); document.getElementById('cet6-count').textContent = cet6Recs.length; }
            else { ['cet6-best','cet6-avg','cet6-count'].forEach(id => document.getElementById(id).textContent = id === 'cet6-count' ? '0' : '-'); }
        }

        function resetAllStats() { ['ielts-best','ielts-avg','ielts-count','ielts-latest','cet4-best','cet4-avg','cet4-count','cet6-best','cet6-avg','cet6-count'].forEach(id => { const el = document.getElementById(id); el.textContent = id.includes('count') ? '0' : '-'; }); }

        function updateRecordsList(records) {
            const list = document.getElementById('records-list');
            if (records.length === 0) { list.innerHTML = '<div class="text-center py-12 text-gray-400"><div class="text-5xl mb-3">æš‚æ— è®°å½•</div><p class="text-lg text-gray-600">è¿˜æ²¡æœ‰å½•å…¥ä»»ä½•æˆç»©</p></div>'; return; }
            list.innerHTML = [...records].reverse().map(r => {
                if (r.examType === 'ielts') {
                    return '<div class="bg-gradient-to-r from-white to-gray-50 rounded-lg p-5 border-2 border-gray-200 hover:border-emerald-300 transition-all"><div class="flex justify-between items-start"><div class="flex-1"><div class="text-gray-800 font-semibold mb-2">' + r.date + ' - é›…æ€å­¦æœ¯ç±»</div><div class="text-gray-600 text-sm flex gap-3 flex-wrap"><span class="bg-blue-100 text-blue-700 px-2 py-1 rounded">L: ' + r.listening.score.toFixed(1) + '</span><span class="bg-emerald-100 text-emerald-700 px-2 py-1 rounded">R: ' + r.reading.score.toFixed(1) + '</span><span class="bg-amber-100 text-amber-700 px-2 py-1 rounded">W: ' + r.writing.score.toFixed(1) + '</span><span class="bg-purple-100 text-purple-700 px-2 py-1 rounded">S: ' + r.speaking.score.toFixed(1) + '</span></div><div class="flex items-center gap-2 mt-2"><span class="text-gray-600 text-sm">Overall:</span><span class="text-3xl font-bold gradient-text-bright">' + r.overall.toFixed(1) + '</span></div></div><button onclick="deleteRecord(' + r.id + ')" class="ml-4 text-gray-400 hover:text-red-500">åˆ é™¤</button></div></div>';
                } else {
                    const examName = r.examLevel === 'cet4' ? 'å››çº§' : 'å…­çº§';
                    return '<div class="bg-gradient-to-r from-white to-gray-50 rounded-lg p-5 border-2 border-gray-200 hover:border-emerald-300 transition-all"><div class="flex justify-between items-start"><div class="flex-1"><div class="text-gray-800 font-semibold mb-2">' + r.date + ' - å¤§å­¦' + examName + '</div><div class="text-gray-600 text-sm flex gap-3 flex-wrap"><span class="bg-blue-100 text-blue-700 px-2 py-1 rounded">å¬åŠ›: ' + r.listening.total + '</span><span class="bg-emerald-100 text-emerald-700 px-2 py-1 rounded">é˜…è¯»: ' + r.reading.total + '</span><span class="bg-orange-100 text-orange-700 px-2 py-1 rounded">å†™ä½œç¿»è¯‘: ' + (r.writing.score + r.translation.score) + '</span></div><div class="flex items-center gap-2 mt-2"><span class="text-gray-600 text-sm">æ€»åˆ†:</span><span class="text-3xl font-bold gradient-text-bright">' + r.total + '</span></div></div><button onclick="deleteRecord(' + r.id + ')" class="ml-4 text-gray-400 hover:text-red-500">åˆ é™¤</button></div></div>';
                }
            }).join('');
        }

        function updateIeltsOverall() { const l = parseFloat(document.getElementById('ielts-listening-score').textContent) || 0; const r = parseFloat(document.getElementById('ielts-reading-score').textContent) || 0; const w = parseFloat(ieltsW.value) || 0; const s = parseFloat(ieltsS.value) || 0; document.getElementById('ielts-overall-l').textContent = l.toFixed(1); document.getElementById('ielts-overall-r').textContent = r.toFixed(1); document.getElementById('ielts-overall-w').textContent = w.toFixed(1); document.getElementById('ielts-overall-s').textContent = s.toFixed(1); document.getElementById('ielts-overall-score').textContent = calculateOverall(l,r,w,s).toFixed(1); }

        document.getElementById('ielts-form').addEventListener('submit', function(e) {
            e.preventDefault();
            if (!validateNumberInput(ieltsL, 0, 40, 'ielts-listening-warning') || !validateNumberInput(ieltsR, 0, 40, 'ielts-reading-warning') || !validateNumberInput(ieltsW, 0, 9, 'ielts-writing-warning') || !validateNumberInput(ieltsS, 0, 9, 'ielts-speaking-warning')) { alert('è¯·ä¿®æ­£è¾“å…¥é”™è¯¯'); return; }
            const record = { id: Date.now(), examType: 'ielts', date: document.getElementById('ielts-exam-date').value, listening: { raw: parseInt(ieltsL.value), score: calculateListeningScore(parseInt(ieltsL.value)) }, reading: { raw: parseInt(ieltsR.value), score: calculateReadingScore(parseInt(ieltsR.value)) }, writing: { score: parseFloat(ieltsW.value) }, speaking: { score: parseFloat(ieltsS.value) }, overall: calculateOverall(calculateListeningScore(parseInt(ieltsL.value)), calculateReadingScore(parseInt(ieltsR.value)), parseFloat(ieltsW.value), parseFloat(ieltsS.value)) };
            saveRecord(record); updateUI(); this.reset(); document.getElementById('ielts-listening-score').textContent = '0.0'; document.getElementById('ielts-reading-score').textContent = '0.0'; updateIeltsOverall(); initAccordions(); alert('é›…æ€æˆç»©ä¿å­˜æˆåŠŸï¼');
        });

        // é›…æ€è¡¨å•äº‹ä»¶
        const ieltsL = document.getElementById('ielts-listening-raw');
        const ieltsR = document.getElementById('ielts-reading-raw');
        const ieltsW = document.getElementById('ielts-writing-score');
        const ieltsS = document.getElementById('ielts-speaking-score');
        ieltsL.addEventListener('input', function() {
            document.getElementById('ielts-listening-score').textContent = calculateListeningScore(parseInt(this.value) || 0).toFixed(1);
            updateIeltsOverall();
            updateAccordionStatus('ielts-listening-raw', 'ielts-listening-status');
        });
        ieltsR.addEventListener('input', function() {
            document.getElementById('ielts-reading-score').textContent = calculateReadingScore(parseInt(this.value) || 0).toFixed(1);
            updateIeltsOverall();
            updateAccordionStatus('ielts-reading-raw', 'ielts-reading-status');
        });
        ieltsW.addEventListener('input', function() { updateIeltsOverall(); updateAccordionStatus('ielts-writing-score', 'ielts-writing-status'); });
        ieltsS.addEventListener('input', function() { updateIeltsOverall(); updateAccordionStatus('ielts-speaking-score', 'ielts-speaking-status'); });

        // å››å…­çº§è¡¨å•äº‹ä»¶
        const cetL_A = document.getElementById('cet-listening-sectiona');
        const cetL_B = document.getElementById('cet-listening-sectionb');
        const cetL_C = document.getElementById('cet-listening-sectionc');
        const cetRW = document.getElementById('cet-reading-wordbank');
        const cetRS = document.getElementById('cet-reading-skimming');
        const cetRR = document.getElementById('cet-reading-reading');
        const cetWR = document.getElementById('cet-writing-raw');
        const cetTR = document.getElementById('cet-translation-raw');
        [cetL_A, cetL_B, cetL_C].forEach(i => i.addEventListener('input', updateCetPreview));
        [cetRW, cetRS, cetRR].forEach(i => i.addEventListener('input', updateCetPreview));
        cetWR.addEventListener('input', updateCetPreview);
        cetTR.addEventListener('input', updateCetPreview);

        function updateCetPreview() {
            const lt = calculateCetListening(parseInt(cetL_A.value)||0, parseInt(cetL_B.value)||0, parseInt(cetL_C.value)||0);
            const rt = calculateCetReading(parseInt(cetRW.value)||0, parseInt(cetRS.value)||0, parseInt(cetRR.value)||0);
            const ws = convertRawToReportScore(parseFloat(cetWR.value)||0);
            const ts = convertRawToReportScore(parseFloat(cetTR.value)||0);
            document.getElementById('cet-listening-total').textContent = lt; document.getElementById('cet-total-listening').textContent = lt;
            document.getElementById('cet-reading-total').textContent = rt; document.getElementById('cet-total-reading').textContent = rt;
            document.getElementById('cet-writing-score').textContent = ws;
            document.getElementById('cet-translation-score').textContent = ts;
            document.getElementById('cet-total-wt').textContent = ws + ts;
            document.getElementById('cet-total-score').textContent = lt + rt + ws + ts;
        }

        document.getElementById('cet-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const valid = validateNumberInput(cetL_A,0,8,'cet-sectiona-warning') && validateNumberInput(cetL_B,0,7,'cet-sectionb-warning') && validateNumberInput(cetL_C,0,10,'cet-sectionc-warning') && validateNumberInput(cetRW,0,10,'cet-wordbank-warning') && validateNumberInput(cetRS,0,10,'cet-skimming-warning') && validateNumberInput(cetRR,0,10,'cet-reading-warning') && validateNumberInput(cetWR,0,15,'cet-writing-warning') && validateNumberInput(cetTR,0,15,'cet-translation-warning');
            if (!valid) { alert('è¯·ä¿®æ­£è¾“å…¥é”™è¯¯'); return; }
            const lt = calculateCetListening(parseInt(cetL_A.value), parseInt(cetL_B.value), parseInt(cetL_C.value));
            const rt = calculateCetReading(parseInt(cetRW.value), parseInt(cetRS.value), parseInt(cetRR.value));
            const ws = convertRawToReportScore(parseFloat(cetWR.value));
            const ts = convertRawToReportScore(parseFloat(cetTR.value));
            const total = lt + rt + ws + ts;
            const record = { id: Date.now(), examType: 'cet', examLevel: currentExamType, date: document.getElementById('cet-exam-date').value, listening: { sectionA: { count: parseInt(cetL_A.value) }, sectionB: { count: parseInt(cetL_B.value) }, sectionC: { count: parseInt(cetL_C.value) }, total: lt }, reading: { wordBank: { count: parseInt(cetRW.value) }, skimming: { count: parseInt(cetRS.value) }, reading: { count: parseInt(cetRR.value) }, total: rt }, writing: { raw: parseFloat(cetWR.value), score: ws }, translation: { raw: parseFloat(cetTR.value), score: ts }, total: total };
            saveRecord(record); updateUI(); this.reset(); updateCetPreview(); initAccordions(); alert(`${currentExamType === 'cet4' ? 'å››çº§' : 'å…­çº§'}æˆç»©ä¿å­˜æˆåŠŸï¼æ€»åˆ†: ${total}`);
        });

        function init() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('ielts-exam-date').value = today;
            document.getElementById('cet-exam-date').value = today;
            updateUI();
        }
        document.addEventListener('DOMContentLoaded', init);
    </script>
    <footer class="mt-12 py-6 text-center">
        <p class="text-gray-500 text-sm font-sans tracking-wide">Copyright <span class="italic">&copy;LYT</span>ï¼Œ2026 All Rights Reserved</p>
    </footer>
</body>
</html>
