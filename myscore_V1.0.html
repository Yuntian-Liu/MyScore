<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyScore - æˆ‘çš„æˆç»©å•</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* è‡ªå®šä¹‰æ ·å¼è¡¥å…… */
        .glass-effect {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .gradient-text {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        .input-glow:focus {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
        }
    </style>
</head>
<body class="bg-slate-900 min-h-screen text-gray-100">
    <div id="app" class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- å¤´éƒ¨å¯¼èˆª -->
        <header class="mb-8">
            <div class="glass-effect rounded-2xl p-6 flex justify-between items-center">
                <div>
                    <h1 class="text-3xl font-bold gradient-text">MyScore</h1>
                    <p class="text-slate-400 text-sm mt-1">æˆ‘çš„æˆç»©å• - é›…æ€å¬åŠ›è¿½è¸ª</p>
                </div>
                <nav class="flex gap-3">
                    <button onclick="showPage('dashboard')" id="nav-dashboard" 
                        class="px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 transition-all font-medium">
                        ä»ªè¡¨ç›˜
                    </button>
                    <button onclick="showPage('entry')" id="nav-entry"
                        class="px-4 py-2 rounded-lg bg-slate-700 hover:bg-slate-600 transition-all font-medium">
                        å½•å…¥æˆç»©
                    </button>
                </nav>
            </div>
        </header>

        <!-- ä»ªè¡¨ç›˜é¡µé¢ -->
        <div id="page-dashboard" class="page">
            <!-- æœ€è¿‘æˆç»©å¡ç‰‡ -->
            <div id="recent-score-card" class="glass-effect rounded-2xl p-8 mb-6 card-hover transition-all duration-300">
                <h2 class="text-xl font-semibold text-slate-300 mb-6">ğŸ“Š æœ€è¿‘æˆç»©</h2>
                <div id="recent-score-content">
                    <!-- åŠ¨æ€å†…å®¹ -->
                </div>
            </div>

            <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="glass-effect rounded-xl p-6 card-hover transition-all duration-300">
                    <div class="text-slate-400 text-sm mb-2">æ€»è€ƒè¯•æ¬¡æ•°</div>
                    <div id="total-count" class="text-3xl font-bold text-blue-400">0</div>
                </div>
                <div class="glass-effect rounded-xl p-6 card-hover transition-all duration-300">
                    <div class="text-slate-400 text-sm mb-2">æœ€é«˜åˆ†</div>
                    <div id="highest-score" class="text-3xl font-bold text-green-400">-</div>
                </div>
                <div class="glass-effect rounded-xl p-6 card-hover transition-all duration-300">
                    <div class="text-slate-400 text-sm mb-2">å¹³å‡åˆ†</div>
                    <div id="average-score" class="text-3xl font-bold text-purple-400">-</div>
                </div>
            </div>
        </div>

        <!-- å½•å…¥é¡µé¢ -->
        <div id="page-entry" class="page hidden">
            <!-- å½•å…¥è¡¨å• -->
            <div class="glass-effect rounded-2xl p-8 mb-6">
                <h2 class="text-xl font-semibold text-slate-300 mb-6">ğŸ“ å½•å…¥é›…æ€å¬åŠ›æˆç»©</h2>
                <form id="score-form" class="space-y-6">
                    <div>
                        <label class="block text-slate-400 text-sm mb-2">è€ƒè¯•æ—¥æœŸ</label>
                        <input type="date" id="exam-date" required
                            class="w-full bg-slate-800 border border-slate-600 rounded-lg px-4 py-3 text-white input-glow focus:outline-none focus:border-blue-500 transition-all">
                    </div>
                    <div>
                        <label class="block text-slate-400 text-sm mb-2">ç§‘ç›®</label>
                        <select id="exam-subject" required
                            class="w-full bg-slate-800 border border-slate-600 rounded-lg px-4 py-3 text-white input-glow focus:outline-none focus:border-blue-500 transition-all">
                            <option value="é›…æ€å¬åŠ›">é›…æ€å¬åŠ›</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-slate-400 text-sm mb-2">æ­£ç¡®é¢˜æ•° (0-40)</label>
                        <input type="number" id="correct-count" min="0" max="40" required placeholder="è¯·è¾“å…¥æ­£ç¡®é¢˜æ•°"
                            class="w-full bg-slate-800 border border-slate-600 rounded-lg px-4 py-3 text-white input-glow focus:outline-none focus:border-blue-500 transition-all">
                    </div>
                    
                    <!-- å®æ—¶é¢„è§ˆ -->
                    <div class="bg-slate-800/50 rounded-lg p-4 border border-slate-700">
                        <div class="text-slate-400 text-sm mb-2">åˆ†æ•°é¢„è§ˆ</div>
                        <div class="flex items-center gap-4">
                            <div>
                                <span class="text-slate-500 text-sm">åŸå§‹åˆ†ï¼š</span>
                                <span id="preview-raw" class="text-white font-semibold">0</span>
                            </div>
                            <div class="text-slate-600">â†’</div>
                            <div>
                                <span class="text-slate-500 text-sm">æŠ˜ç®—åˆ†ï¼š</span>
                                <span id="preview-converted" class="text-2xl font-bold gradient-text">0.0</span>
                            </div>
                        </div>
                    </div>

                    <button type="submit" 
                        class="w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-semibold py-3 px-6 rounded-lg transition-all transform hover:scale-[1.02] active:scale-[0.98]">
                        ğŸ’¾ ä¿å­˜æˆç»©
                    </button>
                </form>
            </div>

            <!-- æˆç»©è®°å½•åˆ—è¡¨ -->
            <div class="glass-effect rounded-2xl p-8">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-semibold text-slate-300">ğŸ“‹ å†å²è®°å½•</h2>
                    <button onclick="clearAllRecords()" class="text-red-400 hover:text-red-300 text-sm transition-colors">
                        æ¸…ç©ºæ‰€æœ‰è®°å½•
                    </button>
                </div>
                <div id="records-list" class="space-y-3">
                    <!-- åŠ¨æ€å†…å®¹ -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== æ•°æ®å­˜å‚¨ ====================
        const STORAGE_KEY = 'myscore_records';

        // è·å–æ‰€æœ‰è®°å½•
        function getRecords() {
            const records = localStorage.getItem(STORAGE_KEY);
            return records ? JSON.parse(records) : [];
        }

        // ä¿å­˜è®°å½•
        function saveRecord(record) {
            const records = getRecords();
            records.push(record);
            localStorage.setItem(STORAGE_KEY, JSON.stringify(records));
        }

        // æ¸…ç©ºæ‰€æœ‰è®°å½•
        function clearAllRecords() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æˆç»©è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚')) {
                localStorage.removeItem(STORAGE_KEY);
                updateUI();
            }
        }

        // ==================== è¯„åˆ†é€»è¾‘ï¼ˆé¢„ç•™æ‰©å±•ä½ç½®ï¼‰====================
        function calculateIeltsListeningScore(correctCount) {
            // é›…æ€å¬åŠ›è¯„åˆ†è¡¨ï¼ˆç¡¬ç¼–ç ç‰ˆæœ¬ï¼‰
            // é¢„ç•™ä½ç½®ï¼šåç»­å¯ä¿®æ”¹ä¸ºä»é…ç½®æ–‡ä»¶è¯»å–æˆ–åŠ¨æ€ç”Ÿæˆ
            
            const scoreTable = [
                { range: [39, 40], score: 9.0 },
                { range: [37, 38], score: 8.5 },
                { range: [35, 36], score: 8.0 },
                { range: [32, 34], score: 7.5 },
                { range: [30, 31], score: 7.0 },
                { range: [26, 29], score: 6.5 },
                { range: [23, 25], score: 6.0 },
                { range: [18, 22], score: 5.5 },
                { range: [16, 17], score: 5.0 },
                { range: [13, 15], score: 4.5 },
                { range: [10, 12], score: 4.0 },
                { range: [6, 9], score: 3.5 },
                { range: [4, 5], score: 3.0 },
                { range: [3, 3], score: 2.5 },
                { range: [2, 2], score: 2.0 },
                { range: [1, 1], score: 1.0 },
                { range: [0, 0], score: 0.5 }
            ];

            for (const item of scoreTable) {
                if (correctCount >= item.range[0] && correctCount <= item.range[1]) {
                    return item.score;
                }
            }
            return 0.0;
        }

        // ==================== UI æ¸²æŸ“ ====================
        function showPage(pageName) {
            // éšè—æ‰€æœ‰é¡µé¢
            document.querySelectorAll('.page').forEach(page => {
                page.classList.add('hidden');
            });
            
            // æ˜¾ç¤ºç›®æ ‡é¡µé¢
            document.getElementById(`page-${pageName}`).classList.remove('hidden');
            
            // æ›´æ–°å¯¼èˆªæŒ‰é’®æ ·å¼
            document.getElementById('nav-dashboard').className = pageName === 'dashboard' 
                ? 'px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 transition-all font-medium'
                : 'px-4 py-2 rounded-lg bg-slate-700 hover:bg-slate-600 transition-all font-medium';
            document.getElementById('nav-entry').className = pageName === 'entry'
                ? 'px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 transition-all font-medium'
                : 'px-4 py-2 rounded-lg bg-slate-700 hover:bg-slate-600 transition-all font-medium';
            
            // æ›´æ–°UI
            updateUI();
        }

        function updateUI() {
            const records = getRecords();
            
            // æ›´æ–°ä»ªè¡¨ç›˜
            updateDashboard(records);
            
            // æ›´æ–°è®°å½•åˆ—è¡¨
            updateRecordsList(records);
        }

        function updateDashboard(records) {
            const recentScoreContent = document.getElementById('recent-score-content');
            const totalCountEl = document.getElementById('total-count');
            const highestScoreEl = document.getElementById('highest-score');
            const averageScoreEl = document.getElementById('average-score');
            
            if (records.length === 0) {
                recentScoreContent.innerHTML = `
                    <div class="text-center py-8 text-slate-400">
                        <div class="text-5xl mb-4">ğŸ“­</div>
                        <p>è¿˜æ²¡æœ‰æˆç»©è®°å½•</p>
                        <p class="text-sm mt-2">ç‚¹å‡»"å½•å…¥æˆç»©"å¼€å§‹è®°å½•ä½ çš„è¿›æ­¥</p>
                    </div>
                `;
                totalCountEl.textContent = '0';
                highestScoreEl.textContent = '-';
                averageScoreEl.textContent = '-';
                return;
            }
            
            // æœ€æ–°è®°å½•
            const latest = records[records.length - 1];
            recentScoreContent.innerHTML = `
                <div class="flex items-center justify-between">
                    <div>
                        <div class="text-slate-400 text-sm">${latest.date}</div>
                        <div class="text-lg font-semibold text-white mt-1">${latest.subject}</div>
                    </div>
                    <div class="text-right">
                        <div class="text-slate-400 text-sm">æ­£ç¡®é¢˜æ•°</div>
                        <div class="text-xl font-semibold text-blue-400 mt-1">${latest.rawScore} / 40</div>
                    </div>
                    <div class="text-right">
                        <div class="text-slate-400 text-sm">æŠ˜ç®—åˆ†</div>
                        <div class="text-4xl font-bold gradient-text mt-1">${latest.convertedScore}</div>
                    </div>
                </div>
            `;
            
            // ç»Ÿè®¡æ•°æ®
            totalCountEl.textContent = records.length;
            
            const scores = records.map(r => r.convertedScore);
            const maxScore = Math.max(...scores);
            const avgScore = (scores.reduce((a, b) => a + b, 0) / scores.length).toFixed(1);
            
            highestScoreEl.textContent = maxScore;
            averageScoreEl.textContent = avgScore;
        }

        function updateRecordsList(records) {
            const recordsList = document.getElementById('records-list');
            
            if (records.length === 0) {
                recordsList.innerHTML = `
                    <div class="text-center py-8 text-slate-400">
                        <div class="text-4xl mb-3">ğŸ“</div>
                        <p>æš‚æ— è®°å½•</p>
                    </div>
                `;
                return;
            }
            
            // æŒ‰æ—¥æœŸå€’åºæ’åˆ—
            const sortedRecords = [...records].reverse();
            
            recordsList.innerHTML = sortedRecords.map(record => `
                <div class="bg-slate-800/50 rounded-lg p-4 border border-slate-700 hover:border-slate-600 transition-all">
                    <div class="flex justify-between items-center">
                        <div>
                            <div class="text-white font-medium">${record.subject}</div>
                            <div class="text-slate-400 text-sm mt-1">${record.date}</div>
                        </div>
                        <div class="text-right">
                            <div class="text-slate-400 text-sm">æ­£ç¡®é¢˜æ•°</div>
                            <div class="text-blue-400 font-semibold">${record.rawScore} / 40</div>
                        </div>
                        <div class="text-right">
                            <div class="text-slate-400 text-sm">æŠ˜ç®—åˆ†</div>
                            <div class="text-2xl font-bold gradient-text">${record.convertedScore}</div>
                        </div>
                        <button onclick="deleteRecord(${record.id})" 
                            class="ml-4 text-slate-500 hover:text-red-400 transition-colors">
                            âœ•
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function deleteRecord(id) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ')) {
                const records = getRecords().filter(r => r.id !== id);
                localStorage.setItem(STORAGE_KEY, JSON.stringify(records));
                updateUI();
            }
        }

        // ==================== è¡¨å•å¤„ç† ====================
        const scoreForm = document.getElementById('score-form');
        const correctCountInput = document.getElementById('correct-count');
        const previewRaw = document.getElementById('preview-raw');
        const previewConverted = document.getElementById('preview-converted');

        // å®æ—¶é¢„è§ˆ
        correctCountInput.addEventListener('input', function() {
            const count = parseInt(this.value) || 0;
            const score = calculateIeltsListeningScore(count);
            previewRaw.textContent = count;
            previewConverted.textContent = score.toFixed(1);
        });

        // è¡¨å•æäº¤
        scoreForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const date = document.getElementById('exam-date').value;
            const subject = document.getElementById('exam-subject').value;
            const rawScore = parseInt(correctCountInput.value);
            const convertedScore = calculateIeltsListeningScore(rawScore);
            
            const record = {
                id: Date.now(),
                date: date,
                subject: subject,
                rawScore: rawScore,
                convertedScore: convertedScore
            };
            
            saveRecord(record);
            updateUI();
            
            // é‡ç½®è¡¨å•
            scoreForm.reset();
            previewRaw.textContent = '0';
            previewConverted.textContent = '0.0';
            
            // æ˜¾ç¤ºæˆåŠŸæç¤º
            alert('âœ… æˆç»©ä¿å­˜æˆåŠŸï¼');
        });

        // ==================== åˆå§‹åŒ– ====================
        function init() {
            // è®¾ç½®é»˜è®¤æ—¥æœŸä¸ºä»Šå¤©
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('exam-date').value = today;
            
            // åˆå§‹åŒ–UI
            updateUI();
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>